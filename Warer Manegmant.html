<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ù…Ø¯ÛŒØ±ÛŒØª Ø¢Ø¨ Ú©Ø´Ø§ÙˆØ±Ø²ÛŒ Ø¨Ø§ ØªØ­Ù„ÛŒÙ„</title>
  <style>
    body {
      font-family: Tahoma, sans-serif;
      direction: rtl;
      background: #f4f9f9;
      margin: 0;
      padding: 20px;
      color: #2c3e50;
    }
    h1, h2, h3, h4 {
      text-align: center;
      margin-bottom: 15px;
    }
    .container {
      max-width: 900px;
      margin: auto;
      background: white;
      padding: 25px 30px;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
    }
    label {
      display: block;
      margin: 12px 0 6px;
      font-weight: bold;
    }
    input, select, button {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border-radius: 5px;
      border: 1px solid #ccc;
      font-size: 16px;
      box-sizing: border-box;
      transition: border-color 0.3s ease;
    }
    input:focus, select:focus {
      border-color: #3498db;
      outline: none;
    }
    button {
      background-color: #3498db;
      color: white;
      border: none;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #2980b9;
    }
    .help-text {
      font-size: 12px;
      color: #555;
      margin-top: -10px;
      margin-bottom: 10px;
    }
    .error {
      border-color: crimson !important;
      background-color: #ffe6e6;
    }
    .error-message {
      color: crimson;
      font-size: 12px;
      margin-top: -10px;
      margin-bottom: 10px;
      display: none; /* Initially hidden */
    }
    #result {
      margin-top: 25px;
      background-color: #eaf2f8;
      border-radius: 8px;
      padding: 20px;
      font-size: 16px;
      line-height: 1.5;
      color: #2c3e50;
    }
    #history {
      margin-top: 30px;
      font-size: 14px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    table, th, td {
      border: 1px solid #ccc;
    }
    th, td {
      padding: 8px;
      text-align: center;
    }
    .delete-btn {
      background: crimson;
      color: white;
      border: none;
      border-radius: 5px;
      padding: 5px 10px;
      cursor: pointer;
      font-size: 14px;
    }
    .status-badge {
      font-weight: bold;
      margin-right: 8px;
      padding: 3px 8px;
      border-radius: 15px;
      color: white;
      font-size: 14px;
    }
    .Ø¨Ø§Ù„Ø§ { background-color: #e74c3c; }
    .Ù…ØªÙˆØ³Ø· { background-color: #f39c12; }
    .Ù…Ù†Ø§Ø³Ø¨ { background-color: #27ae60; }
    .progress-bar {
      height: 18px;
      border-radius: 9px;
      background-color: #3498db;
      color: white;
      text-align: center;
      line-height: 18px;
      margin-top: 4px;
      font-size: 13px;
      font-weight: bold;
    }
    .analysis-section ul {
      list-style-type: disc;
      padding-right: 20px;
      margin-top: 0;
      margin-bottom: 15px;
    }
    .analysis-section ul li {
      margin-bottom: 6px;
    }
    .alert-message p {
      margin: 8px 0;
      font-weight: bold;
    }
    .chart-bar {
      background-color: #3498db;
      color: white;
      padding: 8px;
      border-radius: 6px;
      margin-bottom: 6px;
      max-width: 100%;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .chart-average {
      font-size: 14px;
      color: #555;
      text-align: center;
      margin-bottom: 15px;
    }
    @media (max-width: 768px) {
      .container {
        padding: 15px 20px;
      }
      input, select, button {
        font-size: 18px;
        padding: 14px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù…Ø¯ÛŒØ±ÛŒØª Ø¢Ø¨ Ú©Ø´Ø§ÙˆØ±Ø²ÛŒ Ø¨Ø§ ØªØ­Ù„ÛŒÙ„</h1>
    <form id="waterForm" onsubmit="event.preventDefault(); calculateAndSave();">
      <label for="location">Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ø²Ø±Ø¹Ù‡</label>
      <input type="text" id="location" placeholder="Ù…Ø«Ù„Ø§Ù‹ Ú©Ø±Ø¬ ÛŒØ§ 35.8, 50.9" aria-label="Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ø²Ø±Ø¹Ù‡" required />
      <small class="help-text">Ù†Ø§Ù… Ø´Ù‡Ø± ÛŒØ§ Ù…Ø®ØªØµØ§Øª Ø¬ØºØ±Ø§ÙÛŒØ§ÛŒÛŒ</small>
      <div class="error-message" id="locationError">Ù„Ø·ÙØ§ Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ø²Ø±Ø¹Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.</div>

      <label for="soilType">Ù†ÙˆØ¹ Ø®Ø§Ú©</label>
      <select id="soilType" aria-label="Ù†ÙˆØ¹ Ø®Ø§Ú©" required>
        <option value="" disabled selected>Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</option>
        <option value="1.0">Ø´Ù†ÛŒ (Ø®Ø§Ú© Ø³Ø¨Ú©)</option>
        <option value="1.1">Ù„ÙˆÙ…ÛŒ (Ø®Ø§Ú© Ù…ØªÙˆØ³Ø·)</option>
        <option value="1.2">Ø±Ø³ÛŒ (Ø®Ø§Ú© Ø³Ù†Ú¯ÛŒÙ†)</option>
      </select>
      <div class="error-message" id="soilTypeError">Ù„Ø·ÙØ§ Ù†ÙˆØ¹ Ø®Ø§Ú© Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.</div>

      <label for="crop">Ù†ÙˆØ¹ Ú¯ÛŒØ§Ù‡</label>
      <select id="crop" aria-label="Ù†ÙˆØ¹ Ú¯ÛŒØ§Ù‡" required>
        <option value="" disabled selected>Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</option>
        <option value="0.7">Ú¯Ù†Ø¯Ù…</option>
        <option value="1.05">Ø¨Ø±Ù†Ø¬</option>
        <option value="0.85">Ø°Ø±Øª</option>
        <option value="0.95">Ø³ÛŒØ¨â€ŒØ²Ù…ÛŒÙ†ÛŒ</option>
      </select>
      <div class="error-message" id="cropError">Ù„Ø·ÙØ§ Ù†ÙˆØ¹ Ú¯ÛŒØ§Ù‡ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.</div>

      <label for="stage">Ù…Ø±Ø­Ù„Ù‡ Ø±Ø´Ø¯ Ú¯ÛŒØ§Ù‡</label>
      <select id="stage" aria-label="Ù…Ø±Ø­Ù„Ù‡ Ø±Ø´Ø¯ Ú¯ÛŒØ§Ù‡" required>
        <option value="" disabled selected>Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</option>
        <option value="1">Ø§ÙˆÙ„ÛŒÙ‡</option>
        <option value="1.1">Ù…ÛŒØ§Ù†ÛŒ</option>
        <option value="1.25">Ù†Ù‡Ø§ÛŒÛŒ</option>
      </select>
      <div class="error-message" id="stageError">Ù„Ø·ÙØ§ Ù…Ø±Ø­Ù„Ù‡ Ø±Ø´Ø¯ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.</div>

      <label for="et0">ETâ‚€ (ØªØ¨Ø®ÛŒØ± Ùˆ ØªØ¹Ø±Ù‚) mm/day</label>
      <input type="number" id="et0" min="0" step="0.01" placeholder="Ù…Ø«Ù„Ø§Ù‹ 5.2" aria-label="ETâ‚€" required />
      <small class="help-text">Ù…Ù‚Ø¯Ø§Ø± ØªØ¨Ø®ÛŒØ± Ùˆ ØªØ¹Ø±Ù‚ Ø±ÙˆØ²Ø§Ù†Ù‡ (Ù…ÛŒÙ„ÛŒÙ…ØªØ±) Ø§Ø² Ø§ÛŒØ³ØªÚ¯Ø§Ù‡ Ù‡ÙˆØ§Ø´Ù†Ø§Ø³ÛŒ</small>
      <div class="error-message" id="et0Error">Ù„Ø·ÙØ§ Ù…Ù‚Ø¯Ø§Ø± ETâ‚€ Ø±Ø§ Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.</div>

      <label for="efficiency">Ø±Ø§Ù†Ø¯Ù…Ø§Ù† Ø¢Ø¨ÛŒØ§Ø±ÛŒ (%)</label>
      <input type="number" id="efficiency" min="1" max="100" step="1" placeholder="Ù…Ø«Ù„Ø§Ù‹ 80" aria-label="Ø±Ø§Ù†Ø¯Ù…Ø§Ù† Ø¢Ø¨ÛŒØ§Ø±ÛŒ" required />
      <small class="help-text">Ø±Ø§Ù†Ø¯Ù…Ø§Ù† Ø³ÛŒØ³ØªÙ… Ø¢Ø¨ÛŒØ§Ø±ÛŒ Ø¨ÛŒÙ† 1 ØªØ§ 100 Ø¯Ø±ØµØ¯</small>
      <div class="error-message" id="efficiencyError">Ù„Ø·ÙØ§ Ø±Ø§Ù†Ø¯Ù…Ø§Ù† Ø¢Ø¨ÛŒØ§Ø±ÛŒ Ø±Ø§ Ø¨ÛŒÙ† 1 ØªØ§ 100 Ø¯Ø±ØµØ¯ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.</div>

      <label for="rainfall">Ù…Ù‚Ø¯Ø§Ø± Ø¨Ø§Ø±Ø´ (mm)</label>
      <input type="number" id="rainfall" min="0" step="0.1" placeholder="Ù…Ø«Ù„Ø§Ù‹ 2.5" aria-label="Ù…Ù‚Ø¯Ø§Ø± Ø¨Ø§Ø±Ø´" required />
      <small class="help-text">Ø¨Ø§Ø±Ø´ Ø±ÙˆØ²Ø§Ù†Ù‡ ÛŒØ§ Ø¯ÙˆØ±Ù‡ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø±</small>
      <div class="error-message" id="rainfallError">Ù„Ø·ÙØ§ Ù…Ù‚Ø¯Ø§Ø± Ø¨Ø§Ø±Ø´ Ø±Ø§ Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.</div>

      <label for="ec">Ø´ÙˆØ±ÛŒ Ø¢Ø¨ (dS/m)</label>
      <input type="number" id="ec" min="0" step="0.01" placeholder="Ù…Ø«Ù„Ø§Ù‹ 1.2" aria-label="Ø´ÙˆØ±ÛŒ Ø¢Ø¨" required />
      <small class="help-text">Ù…ÛŒØ²Ø§Ù† Ø´ÙˆØ±ÛŒ Ø¢Ø¨ Ø¢Ø¨ÛŒØ§Ø±ÛŒ</small>
      <div class="error-message" id="ecError">Ù„Ø·ÙØ§ Ù…Ù‚Ø¯Ø§Ø± Ø´ÙˆØ±ÛŒ Ø¢Ø¨ Ø±Ø§ Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.</div>

      <label for="irrigation">Ù†ÙˆØ¹ Ø³ÛŒØ³ØªÙ… Ø¢Ø¨ÛŒØ§Ø±ÛŒ</label>
      <select id="irrigation" aria-label="Ù†ÙˆØ¹ Ø³ÛŒØ³ØªÙ… Ø¢Ø¨ÛŒØ§Ø±ÛŒ" required>
        <option value="" disabled selected>Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</option>
        <option value="0.9">Ù‚Ø·Ø±Ù‡â€ŒØ§ÛŒ</option>
        <option value="0.75">Ø¨Ø§Ø±Ø§Ù†ÛŒ</option>
        <option value="0.6">ØºØ±Ù‚Ø§Ø¨ÛŒ</option>
      </select>
      <div class="error-message" id="irrigationError">Ù„Ø·ÙØ§ Ù†ÙˆØ¹ Ø³ÛŒØ³ØªÙ… Ø¢Ø¨ÛŒØ§Ø±ÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.</div>

      <button type="submit">Ù…Ø­Ø§Ø³Ø¨Ù‡ Ùˆ Ø°Ø®ÛŒØ±Ù‡</button>
    </form>

    <div id="result" role="region" aria-live="polite"></div>

    <h2>Ø³ÙˆØ§Ø¨Ù‚ Ù…Ø­Ø§Ø³Ø¨Ù‡</h2>
    <div id="history"></div>
  </div>

  <script>
    // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§ Ø¨Ø§ Ù†Ù…Ø§ÛŒØ´ Ø®Ø·Ø§
    function validateInputs() {
      let isValid = true;
      const et0 = document.getElementById('et0');
      const efficiency = document.getElementById('efficiency');
      const rainfall = document.getElementById('rainfall');
      const ec = document.getElementById('ec');
      const selects = ['soilType', 'crop', 'stage', 'irrigation'];
      const textInputs = ['location'];
      
      // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ú©Ù„Ø§Ø³ Ø®Ø·Ø§ Ùˆ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø®Ø·Ø§
      [et0, efficiency, rainfall, ec].forEach(el => {
        el.classList.remove('error');
        document.getElementById(el.id + 'Error').style.display = 'none';
      });
      selects.forEach(id => {
        const el = document.getElementById(id);
        el.classList.remove('error');
        document.getElementById(id + 'Error').style.display = 'none';
      });
      textInputs.forEach(id => {
        const el = document.getElementById(id);
        el.classList.remove('error');
        document.getElementById(id + 'Error').style.display = 'none';
      });

      // Ú†Ú© Ú©Ø±Ø¯Ù† ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø¹Ø¯Ø¯ÛŒ
      if (isNaN(et0.value) || et0.value === '' || et0.value < 0) {
        et0.classList.add('error');
        document.getElementById('et0Error').style.display = 'block';
        isValid = false;
      }
      if (isNaN(efficiency.value) || efficiency.value === '' || efficiency.value < 1 || efficiency.value > 100) {
        efficiency.classList.add('error');
        document.getElementById('efficiencyError').style.display = 'block';
        isValid = false;
      }
      if (isNaN(rainfall.value) || rainfall.value === '' || rainfall.value < 0) {
        rainfall.classList.add('error');
        document.getElementById('rainfallError').style.display = 'block';
        isValid = false;
      }
      if (isNaN(ec.value) || ec.value === '' || ec.value < 0) {
        ec.classList.add('error');
        document.getElementById('ecError').style.display = 'block';
        isValid = false;
      }

      // Ú†Ú© Ú©Ø±Ø¯Ù† Ø§Ù†ØªØ®Ø§Ø¨â€ŒÙ‡Ø§
      selects.forEach(id => {
        const el = document.getElementById(id);
        if (!el.value) {
          el.classList.add('error');
          document.getElementById(id + 'Error').style.display = 'block';
          isValid = false;
        }
      });

      // Ú†Ú© Ú©Ø±Ø¯Ù† Ù…ØªÙ† Ù…ÙˆÙ‚Ø¹ÛŒØª
      textInputs.forEach(id => {
        const el = document.getElementById(id);
        if (!el.value.trim()) {
          el.classList.add('error');
          document.getElementById(id + 'Error').style.display = 'block';
          isValid = false;
        }
      });

      return isValid;
    }

    function calculateAndSave() {
      if (!validateInputs()) return;

      const data = {
        location: sanitizeInput(document.getElementById('location').value.trim()),
        soilFactor: parseFloat(document.getElementById('soilType').value),
        cropFactor: parseFloat(document.getElementById('crop').value),
        stageFactor: parseFloat(document.getElementById('stage').value),
        et0: parseFloat(document.getElementById('et0').value),
        efficiency: parseFloat(document.getElementById('efficiency').value),
        rainfall: parseFloat(document.getElementById('rainfall').value),
        ec: parseFloat(document.getElementById('ec').value),
        irrigationFactor: parseFloat(document.getElementById('irrigation').value),
        date: new Date().toLocaleDateString('fa-IR')
      };

      // Ù…Ø­Ø§Ø³Ø¨Ù‡ kc Ùˆ Ù†ÛŒØ§Ø² Ø¢Ø¨ÛŒ
      const kc = data.cropFactor * data.stageFactor * data.soilFactor;
      let waterNeed = (data.et0 * kc) / (data.efficiency / 100);
      waterNeed = Math.max(waterNeed - data.rainfall, 0);

      data.waterNeed = waterNeed.toFixed(2);

      // Ù¾ÛŒØ§Ù… Ø´ÙˆØ±ÛŒ Ø¢Ø¨
      let ecMsg = data.ec > 3 ? 'Ø´ÙˆØ±ÛŒ Ø²ÛŒØ§Ø¯ - Ø®Ø·Ø±Ù†Ø§Ú©' : data.ec > 1.7 ? 'Ø´ÙˆØ±ÛŒ Ù…ØªÙˆØ³Ø· - Ø¨Ø§Ø§Ø­ØªÛŒØ§Ø·' : 'Ø´ÙˆØ±ÛŒ Ù…Ù†Ø§Ø³Ø¨';
      data.ecMessage = ecMsg;

      showResult(data);
      saveData(data);
      renderHistory();

      // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙØ±Ù… Ø¨Ø¹Ø¯ Ø§Ø² Ø«Ø¨Øª
      document.getElementById('waterForm').reset();
      renderHistory(); // Refresh history
    }

    // ØªÙˆØ§Ø¨Ø¹ ØªØ­Ù„ÛŒÙ„ Ùˆ Ù†Ù…Ø§ÛŒØ´ ØªÙˆØ¶ÛŒØ­Ø§Øª Ø¨Ù‡ Ú©Ø´Ø§ÙˆØ±Ø²
    function showResult(data) {
      const analysis = generateAnalysis(data);
      document.getElementById('result').innerHTML = `
        <div class="analysis-section">
          <h3>ğŸ“Š ØªØ­Ù„ÛŒÙ„ Ú©Ø§Ù…Ù„ ÙˆØ¶Ø¹ÛŒØª Ø¢Ø¨ÛŒØ§Ø±ÛŒ</h3>
          
          <div class="stats-box" style="margin-bottom:15px;">
            <div class="stat-item" style="margin-bottom:8px;">
              <span class="stat-label" style="font-weight:bold;">Ù†ÛŒØ§Ø² Ø¢Ø¨ÛŒ Ø±ÙˆØ²Ø§Ù†Ù‡:</span>
              <span class="stat-value" style="margin-right:10px;">${data.waterNeed} Ù…ÛŒÙ„ÛŒâ€ŒÙ…ØªØ±</span>
              ${getWaterNeedStatus(data.waterNeed)}
            </div>
            
            <div class="stat-item">
              <span class="stat-label" style="font-weight:bold;">Ø¨Ù‡Ø±Ù‡â€ŒÙˆØ±ÛŒ Ø³ÛŒØ³ØªÙ… Ø¢Ø¨ÛŒØ§Ø±ÛŒ:</span>
              <span class="stat-value" style="margin-right:10px;">${data.efficiency}%</span>
              ${getEfficiencyStatus(data.efficiency)}
            </div>
          </div>

          <div class="factor-breakdown" style="margin-bottom:15px;">
            <h4>ğŸ” Ø¹ÙˆØ§Ù…Ù„ Ù…Ø¤Ø«Ø± Ø¯Ø± Ù…Ø­Ø§Ø³Ø¨Ù‡:</h4>
            <ul>
              <li>Ø¶Ø±ÛŒØ¨ Ú¯ÛŒØ§Ù‡: ${data.cropFactor} (${getCropName(data.cropFactor)})</li>
              <li>Ù…Ø±Ø­Ù„Ù‡ Ø±Ø´Ø¯: ${data.stageFactor}x (${getStageName(data.stageFactor)})</li>
              <li>Ù†ÙˆØ¹ Ø®Ø§Ú©: ${data.soilFactor}x (${getSoilName(data.soilFactor)})</li>
              <li>Ø¶Ø±ÛŒØ¨ Ø³ÛŒØ³ØªÙ… Ø¢Ø¨ÛŒØ§Ø±ÛŒ: ${data.irrigationFactor}x</li>
            </ul>
          </div>

          <div class="alert-message" style="margin-bottom:15px;">
            <h4>ğŸš¨ Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§ Ùˆ ØªÙˆØµÛŒÙ‡â€ŒÙ‡Ø§:</h4>
            <p>${getSalinityWarning(data.ec)}</p>
            <p>${getRainfallImpact(data.rainfall)}</p>
            <p>${getIrrigationRecommendation(data.waterNeed, data.irrigationFactor)}</p>
          </div>

          <div class="comparison-chart">
            <h4>ğŸ“ˆ Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø¨Ø§ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù…Ù†Ø·Ù‚Ù‡</h4>
            <div class="chart-bar" style="width: ${Math.min(data.waterNeed, 15) * 6.5}%; max-width: 100%;">
              Ù†ÛŒØ§Ø² Ø´Ù…Ø§: ${data.waterNeed} Ù…ÛŒÙ„ÛŒâ€ŒÙ…ØªØ±
            </div>
            <div class="chart-average">Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù…Ù†Ø·Ù‚Ù‡: 8.2 Ù…ÛŒÙ„ÛŒâ€ŒÙ…ØªØ±</div>
          </div>
        </div>
      `;
    }

    // ÙˆØ¶Ø¹ÛŒØª Ù†ÛŒØ§Ø² Ø¢Ø¨ÛŒ
    function getWaterNeedStatus(value) {
      if (value > 10) return `<span class="status-badge Ø¨Ø§Ù„Ø§">Ù†ÛŒØ§Ø² Ø¢Ø¨ÛŒ Ø¨Ø§Ù„Ø§</span>`;
      if (value > 5) return `<span class="status-badge Ù…ØªÙˆØ³Ø·">Ù†ÛŒØ§Ø² Ø¢Ø¨ÛŒ Ù…ØªÙˆØ³Ø·</span>`;
      return `<span class="status-badge Ù…Ù†Ø§Ø³Ø¨">Ù†ÛŒØ§Ø² Ø¢Ø¨ÛŒ Ù…Ù†Ø§Ø³Ø¨</span>`;
    }

    // ÙˆØ¶Ø¹ÛŒØª Ø±Ø§Ù†Ø¯Ù…Ø§Ù† Ø¢Ø¨ÛŒØ§Ø±ÛŒ
    function getEfficiencyStatus(value) {
      if (value > 85) return `<div class="progress-bar" style="width:100%; background-color:#27ae60;">Ø¹Ø§Ù„ÛŒ</div>`;
      if (value > 60) return `<div class="progress-bar" style="width:70%; background-color:#f39c12;">Ù‚Ø§Ø¨Ù„ Ù‚Ø¨ÙˆÙ„</div>`;
      return `<div class="progress-bar" style="width:40%; background-color:#e74c3c;">Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ù‡Ø¨ÙˆØ¯</div>`;
    }

    // Ù¾ÛŒØ§Ù… Ù‡Ø´Ø¯Ø§Ø± Ø´ÙˆØ±ÛŒ Ø¢Ø¨
    function getSalinityWarning(ec) {
      if (ec > 3) return 'âŒ Ø´ÙˆØ±ÛŒ Ø¢Ø¨ Ø¨Ø³ÛŒØ§Ø± Ø¨Ø§Ù„Ø§! Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø¨Ø§Ø¹Ø« Ú©Ø§Ù‡Ø´ Ø´Ø¯ÛŒØ¯ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ù…Ø­ØµÙˆÙ„ Ø´ÙˆØ¯. ØªÙˆØµÛŒÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ø§Ø² Ø³ÛŒØ³ØªÙ… Ø´Ø³ØªØ´ÙˆÛŒ Ø®Ø§Ú© Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.';
      if (ec > 1.7) return 'âš ï¸ Ø´ÙˆØ±ÛŒ Ø¢Ø¨ Ø¯Ø± Ø­Ø¯ Ù…ØªÙˆØ³Ø· Ø§Ø³Øª. Ù†Ø¸Ø§Ø±Øª Ø¯Ù‚ÛŒÙ‚ Ø¨Ø± EC Ø¢Ø¨ Ùˆ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø±ÙˆØ´â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ù‡Ø´ Ø´ÙˆØ±ÛŒ ØªÙˆØµÛŒÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.';
      return 'âœ… Ø´ÙˆØ±ÛŒ Ø¢Ø¨ Ø¯Ø± Ù…Ø­Ø¯ÙˆØ¯Ù‡ Ø§ÛŒÙ…Ù† Ø§Ø³Øª Ùˆ Ù…Ø´Ú©Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Ú¯ÛŒØ§Ù‡ Ø§ÛŒØ¬Ø§Ø¯ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯.';
    }

    // ØªØ§Ø«ÛŒØ± Ø¨Ø§Ø±Ø´
    function getRainfallImpact(rainfall) {
      if (rainfall > 10) return `â˜” Ø¨Ø§Ø±Ø´ Ù‚Ø§Ø¨Ù„ ØªÙˆØ¬Ù‡ (${rainfall} Ù…ÛŒÙ„ÛŒâ€ŒÙ…ØªØ±) Ø±Ø® Ø¯Ø§Ø¯Ù‡ Ø§Ø³Øª. Ù†ÛŒØ§Ø² Ø¢Ø¨ÛŒ Ø´Ù…Ø§ Ø­Ø¯ÙˆØ¯ 30Ùª Ú©Ø§Ù‡Ø´ ÛŒØ§ÙØªÙ‡ Ø§Ø³Øª.`;
      if (rainfall > 5) return `ğŸŒ§ï¸ Ø¨Ø§Ø±Ø´ Ù…ØªÙˆØ³Ø· (${rainfall} Ù…ÛŒÙ„ÛŒâ€ŒÙ…ØªØ±) Ø±Ø® Ø¯Ø§Ø¯Ù‡ Ø§Ø³Øª. Ù†ÛŒØ§Ø² Ø¢Ø¨ÛŒ Ø´Ù…Ø§ Ø­Ø¯ÙˆØ¯ 15Ùª Ú©Ø§Ù‡Ø´ ÛŒØ§ÙØªÙ‡ Ø§Ø³Øª.`;
      return 'â˜€ï¸ Ø¨Ø§Ø±Ø´ Ù†Ø§Ú†ÛŒØ² Ø¨ÙˆØ¯Ù‡ Ø§Ø³ØªØŒ Ù†ÛŒØ§Ø² Ø¢Ø¨ÛŒ Ú©Ø§Ù…Ù„ Ø§Ø³Øª.';
    }

    // ØªÙˆØµÛŒÙ‡ Ø¢Ø¨ÛŒØ§Ø±ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†ÛŒØ§Ø² Ùˆ Ø³ÛŒØ³ØªÙ…
    function getIrrigationRecommendation(waterNeed, irrigationFactor) {
      if (waterNeed > 15 && irrigationFactor < 0.7) {
        return 'ğŸ”” Ø³ÛŒØ³ØªÙ… Ø¢Ø¨ÛŒØ§Ø±ÛŒ ÙØ¹Ù„ÛŒ Ø´Ù…Ø§ Ø¨Ø±Ø§ÛŒ Ù†ÛŒØ§Ø² Ø¢Ø¨ÛŒ Ø¨Ø§Ù„Ø§ Ù…Ù†Ø§Ø³Ø¨ Ù†ÛŒØ³Øª. Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ø³ÛŒØ³ØªÙ… Ø¢Ø¨ÛŒØ§Ø±ÛŒ Ù‚Ø·Ø±Ù‡â€ŒØ§ÛŒ Ø±Ø§ Ø¯Ø± Ù†Ø¸Ø± Ø¨Ú¯ÛŒØ±ÛŒØ¯.';
      }
      if (waterNeed > 10) {
        return 'â±ï¸ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¢Ø¨ÛŒØ§Ø±ÛŒ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ: 3 Ù†ÙˆØ¨Øª Ø¯Ø± Ø±ÙˆØ²ØŒ Ù‡Ø± Ù†ÙˆØ¨Øª 45 Ø¯Ù‚ÛŒÙ‚Ù‡.';
      }
      return 'ğŸ•’ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¢Ø¨ÛŒØ§Ø±ÛŒ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ: 2 Ù†ÙˆØ¨Øª Ø¯Ø± Ø±ÙˆØ²ØŒ Ù‡Ø± Ù†ÙˆØ¨Øª 30 Ø¯Ù‚ÛŒÙ‚Ù‡.';
    }

    // Ù†Ø§Ù… Ú¯ÛŒØ§Ù‡ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¶Ø±ÛŒØ¨
    function getCropName(factor) {
      switch(factor) {
        case 0.7: return 'Ú¯Ù†Ø¯Ù…';
        case 1.05: return 'Ø¨Ø±Ù†Ø¬';
        case 0.85: return 'Ø°Ø±Øª';
        case 0.95: return 'Ø³ÛŒØ¨â€ŒØ²Ù…ÛŒÙ†ÛŒ';
        default: return 'Ù†Ø§Ù…Ø´Ø®Øµ';
      }
    }

    // Ù†Ø§Ù… Ù…Ø±Ø­Ù„Ù‡ Ø±Ø´Ø¯ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¶Ø±ÛŒØ¨
    function getStageName(factor) {
      switch(factor) {
        case 1: return 'Ø§ÙˆÙ„ÛŒÙ‡';
        case 1.1: return 'Ù…ÛŒØ§Ù†ÛŒ';
        case 1.25: return 'Ù†Ù‡Ø§ÛŒÛŒ';
        default: return 'Ù†Ø§Ù…Ø´Ø®Øµ';
      }
    }

    // Ù†Ø§Ù… Ø®Ø§Ú© Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¶Ø±ÛŒØ¨
    function getSoilName(factor) {
      switch(factor) {
        case 1.0: return 'Ø´Ù†ÛŒ (Ø³Ø¨Ú©)';
        case 1.1: return 'Ù„ÙˆÙ…ÛŒ (Ù…ØªÙˆØ³Ø·)';
        case 1.2: return 'Ø±Ø³ÛŒ (Ø³Ù†Ú¯ÛŒÙ†)';
        default: return 'Ù†Ø§Ù…Ø´Ø®Øµ';
      }
    }

    // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¯Ø± localStorage
    function saveData(data) {
      let records = JSON.parse(localStorage.getItem('waterRecords')) || [];
      records.push(data);
      localStorage.setItem('waterRecords', JSON.stringify(records));
    }

    // Ù†Ù…Ø§ÛŒØ´ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù…Ø­Ø§Ø³Ø¨Ø§Øª
    function renderHistory() {
      let records = JSON.parse(localStorage.getItem('waterRecords')) || [];
      if (records.length === 0) {
        document.getElementById('history').innerHTML = 'Ø±Ú©ÙˆØ±Ø¯ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.';
        return;
      }
      let html = `<table><thead><tr><th>ØªØ§Ø±ÛŒØ®</th><th>Ù…Ø²Ø±Ø¹Ù‡</th><th>Ù†ÛŒØ§Ø² Ø¢Ø¨ÛŒ (mm/day)</th><th>Ø´ÙˆØ±ÛŒ</th><th>Ø­Ø°Ù</th></tr></thead><tbody>`;
      records.forEach((rec, index) => {
        html += `<tr>
          <td>${rec.date}</td>
          <td>${rec.location}</td>
          <td>${rec.waterNeed}</td>
          <td>${rec.ecMessage}</td>
          <td><button class="delete-btn" onclick="deleteRecord(${index})" aria-label="Ø­Ø°Ù Ø±Ú©ÙˆØ±Ø¯ Ø´Ù…Ø§Ø±Ù‡ ${index + 1}">Ø­Ø°Ù</button></td>
        </tr>`;
      });
      html += `</tbody></table>`;
      document.getElementById('history').innerHTML = html;
    }

    // Ø­Ø°Ù Ø±Ú©ÙˆØ±Ø¯ Ø§Ø² ØªØ§Ø±ÛŒØ®Ú†Ù‡
    function deleteRecord(index) {
      let records = JSON.parse(localStorage.getItem('waterRecords')) || [];
      records.splice(index, 1);
      localStorage.setItem('waterRecords', JSON.stringify(records));
      renderHistory();
    }

    // Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² XSS Ø³Ø§Ø¯Ù‡
    function sanitizeInput(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    window.onload = renderHistory;
  </script>
</body>
</html>