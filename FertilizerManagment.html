<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>AgriAdvisor Pro | مشاوره و مدیریت کود کشاورزی</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="سیستم هوشمند مشاوره کود و مدیریت هزینه‌های کشاورزی">
    <meta name="keywords" content="کشاورزی, کود, محاسبه هزینه, مشاوره کشاورزی, AgriAdvisor">
    <meta name="author" content="AgriAdvisor Team">

    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="AgriAdvisor Pro | مشاوره هوشمند کشاورزی">
    <meta property="og:description" content="سیستم تخصصی محاسبه هزینه کود و مشاوره کشاورزی">
    <meta property="og:type" content="website">

    <!-- Favicon -->
    <link rel="icon" href="favicon.ico" type="image/x-icon">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn :wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css ">

    <!-- Toastify JS for Notifications -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css ">

    <style>
        :root {
            --primary: #2e7d32;
            --primary-light: #4caf50;
            --secondary: #1976d2;
            --secondary-light: #2196f3;
            --bg: #f5fff8;
            --text-dark: #222;
            --text-medium: #444;
            --white: #fff;
            --gray-light: #eee;
            --warning: #ff9800;
            --error: #f44336;
            --success: #4caf50;
        }

        * {
            font-family: 'Vazirmatn', sans-serif;
            box-sizing: border-box;
        }

        body {
            margin: 0;
            background-color: var(--bg);
            color: var(--text-dark);
            transition: background-color 0.3s ease;
        }

        .container {
            max-width: 1000px;
            margin: auto;
            padding: 40px 20px;
            animation: fadeIn 1s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }

        .logo-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        svg.logo {
            width: 80px;
            height: 80px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        h1 {
            font-weight: 700;
            font-size: 2rem;
            color: var(--primary);
            margin: 0;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        p.subtitle {
            font-size: 1.1rem;
            color: var(--text-medium);
            margin-top: 10px;
            line-height: 1.6;
        }

        .tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            min-width: 200px;
            padding: 15px 20px;
            border-radius: 10px;
            background: var(--gray-light);
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            border: 2px solid transparent;
        }

        .tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .tab.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary-light);
        }

        .form-section {
            display: none;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }

        .form-section.active {
            display: block;
            animation: slideDown 0.5s ease-in-out;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-dark);
        }

        .input-icon {
            position: relative;
        }

        .input-icon i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary);
        }

        select,
        input[type="number"],
        input[type="text"],
        textarea {
            width: 100%;
            padding: 12px 15px;
            padding-right: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background-color: #f9f9f9;
        }

        select:focus,
        input:focus,
        textarea:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.2);
            background-color: white;
        }

        button {
            margin-top: 15px;
            padding: 14px;
            background: var(--primary);
            color: var(--white);
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        button:hover {
            background: #1b5e20;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        button:active {
            transform: translateY(0);
        }

        button.secondary {
            background: var(--secondary);
        }

        button.secondary:hover {
            background: #1565c0;
        }

        button.warning {
            background: var(--warning);
        }

        button.warning:hover {
            background: #f57c00;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 25px;
        }

        .btn-group button {
            flex: 1;
        }

        canvas {
            margin: 30px auto;
            display: block;
            max-width: 100%;
        }

        .result {
            margin-top: 30px;
            background: var(--white);
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            animation: fadeIn 0.5s ease-in-out;
            border-left: 4px solid var(--primary);
        }

        .result h3 {
            color: var(--primary);
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .result p {
            line-height: 1.8;
            margin-bottom: 10px;
        }

        ul {
            padding-right: 20px;
            list-style-type: none;
        }

        li {
            margin-bottom: 10px;
            position: relative;
            padding-right: 25px;
            line-height: 1.6;
        }

        li::before {
            content: "•";
            color: var(--primary);
            font-size: 1.5rem;
            position: absolute;
            right: 0;
            top: -3px;
        }

        .search-container {
            margin-top: 30px;
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        .search-container label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
        }

        #search {
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background-color: #f9f9f9;
        }

        #search:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.2);
            background-color: white;
        }

        #searchResults {
            margin-top: 15px;
            border-top: 1px solid #eee;
            padding-top: 15px;
        }

        #searchResults li {
            padding: 10px;
            border-radius: 6px;
            transition: background 0.2s;
            cursor: pointer;
        }

        #searchResults li:hover {
            background: #f5f5f5;
        }

        .product-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border-left: 3px solid var(--primary);
        }

        .product-card h4 {
            margin-top: 0;
            color: var(--primary);
        }

        .feature-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .feature-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: transform 0.3s ease;
            border-top: 3px solid var(--primary);
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .feature-card i {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 15px;
            display: block;
        }

        .feature-card h3 {
            margin-top: 0;
            color: var(--primary);
        }

        .footer {
            text-align: center;
            padding: 30px 0;
            margin-top: 50px;
            background: var(--primary);
            color: white;
        }

        .footer p {
            margin: 5px 0;
        }

        .social-icons {
            margin-top: 20px;
        }

        .social-icons a {
            color: white;
            font-size: 1.5rem;
            margin: 0 10px;
            transition: transform 0.3s ease;
        }

        .social-icons a:hover {
            transform: translateY(-3px);
        }

        .notification {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: var(--primary);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px 15px;
            }

            .tabs {
                flex-direction: column;
            }

            .form-section {
                padding: 20px;
            }

            .feature-list {
                grid-template-columns: 1fr;
            }
        }

        /* Dark Mode Toggle */
        .dark-mode-toggle {
            position: absolute;
            top: 20px;
            left: 20px;
            background: transparent;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--primary);
        }

        body.dark-mode {
            --bg: #121212;
            --text-dark: #f5f5f5;
            --text-medium: #e0e0e0;
            --white: #1e1e1e;
            --gray-light: #333;
        }

        body.dark-mode .form-section,
        body.dark-mode .search-container,
        body.dark-mode .product-card,
        body.dark-mode .feature-card,
        body.dark-mode .result {
            background: #1e1e1e;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            border-color: #333;
        }

        body.dark-mode select,
        body.dark-mode input,
        body.dark-mode textarea {
            background: #333;
            color: white;
            border-color: #444;
        }

        body.dark-mode #searchResults li:hover {
            background: #333;
        }
    </style>
</head>
<body>
<div class="container">
    <header>
        <button class="dark-mode-toggle" onclick="toggleDarkMode()">
            <i class="fas fa-moon"></i>
        </button>
        <div class="logo-container">
            <svg class="logo" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2L2 7L12 12L22 7L12 2Z" fill="#4CAF50"/>
                <path d="M2 17L12 22L22 17" stroke="#2196F3" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M2 12L12 17L22 12" stroke="#FF9800" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <div>
                <h1>AgriAdvisor Pro</h1>
                <p class="subtitle">سیستم هوشمند مشاوره کود و مدیریت هزینه‌های کشاورزی</p>
            </div>
        </div>
    </header>

    <div class="tabs">
        <div class="tab active" onclick="switchTab(this, 'calculator')">
            <i class="fas fa-calculator"></i> محاسبه هزینه کود
        </div>
        <div class="tab" onclick="switchTab(this, 'advice')">
            <i class="fas fa-lightbulb"></i> مشاوره کود مناسب
        </div>
        <div class="tab" onclick="switchTab(this, 'products')">
            <i class="fas fa-seedling"></i> راهنمای محصولات
        </div>
        <div class="tab" onclick="switchTab(this, 'fertilizers')">
            <i class="fas fa-flask"></i> انواع کودها
        </div>
    </div>

    <!-- Tab 1: Calculator -->
    <section id="calculator" class="form-section active">
        <div class="form-group">
            <label for="area"><i class="fas fa-ruler-combined"></i> مساحت زمین (هکتار)</label>
            <input type="number" id="area" step="any" placeholder="مثال: 2.5">
        </div>
        <div class="form-group">
            <label for="cropCost"><i class="fas fa-leaf"></i> نوع محصول</label>
            <select id="cropCost">
                <option value="wheat">گندم - 100 کیلو/هکتار</option>
                <option value="corn">ذرت - 120 کیلو/هکتار</option>
                <option value="barley">جو - 80 کیلو/هکتار</option>
                <option value="potato">سیب‌زمینی - 150 کیلو/هکتار</option>
                <option value="tomato">گوجه فرنگی - 130 کیلو/هکتار</option>
            </select>
        </div>
        <div class="form-group">
            <label for="pricePerKilo"><i class="fas fa-tag"></i> قیمت هر کیلو کود (تومان)</label>
            <input type="number" id="pricePerKilo" step="any" value="3000">
        </div>
        <div class="form-group">
            <label for="discount"><i class="fas fa-percentage"></i> تخفیف (درصد)</label>
            <input type="number" id="discount" min="0" max="100" value="0">
        </div>
        <div class="btn-group">
            <button onclick="calculate()"><i class="fas fa-calculator"></i> محاسبه</button>
            <button class="secondary" onclick="saveCalculation()"><i class="fas fa-save"></i> ذخیره</button>
        </div>
        <canvas id="costChart"></canvas>
        <div class="result" id="costResult">
            <h3><i class="fas fa-chart-bar"></i> نتایج محاسبه</h3>
            <p>لطفاً مقادیر را وارد کنید و روی دکمه «محاسبه» کلیک کنید.</p>
        </div>
    </section>

    <!-- Tab 2: Fertilizer Advice -->
    <section id="advice" class="form-section">
        <div class="form-group">
            <label for="plant"><i class="fas fa-leaf"></i> نوع گیاه</label>
            <select id="plant">
                <option value="wheat">گندم</option>
                <option value="corn">ذرت</option>
                <option value="potato">سیب‌زمینی</option>
                <option value="tomato">گوجه فرنگی</option>
                <option value="rice">برنج</option>
                <option value="cotton">پنبه</option>
            </select>
        </div>
        <div class="form-group">
            <label for="soilType"><i class="fas fa-mountain"></i> نوع خاک</label>
            <select id="soilType">
                <option value="sandy">شنی</option>
                <option value="clay">رسی</option>
                <option value="loamy">لومی</option>
                <option value="silty">سیلت</option>
            </select>
        </div>
        <div class="form-group">
            <label for="soilPh"><i class="fas fa-flask"></i> میزان pH خاک</label>
            <input type="number" id="soilPh" step="0.1" min="4" max="9" placeholder="مثال: 6.5">
        </div>
        <div class="form-group">
            <label for="climate"><i class="fas fa-cloud-sun"></i> شرایط آب و هوایی</label>
            <select id="climate">
                <option value="dry">خشک</option>
                <option value="moderate">معتدل</option>
                <option value="humid">مرطوب</option>
                <option value="semi-arid">نیمه خشک</option>
            </select>
        </div>
        <div class="form-group">
            <label for="season"><i class="fas fa-calendar-alt"></i> فصل کاشت</label>
            <select id="season">
                <option value="spring">بهار</option>
                <option value="summer">تابستان</option>
                <option value="fall">پاییز</option>
                <option value="winter">زمستان</option>
            </select>
        </div>
        <div class="btn-group">
            <button onclick="getAdvice()"><i class="fas fa-lightbulb"></i> دریافت مشاوره</button>
            <button class="secondary" onclick="printAdvice()"><i class="fas fa-print"></i> چاپ مشاوره</button>
        </div>
        <canvas id="adviceChart"></canvas>
        <div class="result" id="adviceResult">
            <h3><i class="fas fa-info-circle"></i> راهنمای مشاوره</h3>
            <p>لطفاً اطلاعات را وارد کنید و مشاوره بگیرید.</p>
        </div>
    </section>

    <!-- Tab 3: Products Guide -->
    <section id="products" class="form-section">
        <div class="search-container">
            <label for="productSearch"><i class="fas fa-search"></i> جستجوی محصولات</label>
            <div class="input-icon">
                <i class="fas fa-search"></i>
                <input type="text" id="productSearch" oninput="searchProducts()" placeholder="نام محصول را وارد کنید...">
            </div>
            <ul id="searchResults"></ul>
        </div>
        <div class="feature-list">
            <div class="feature-card">
                <i class="fas fa-book-open"></i>
                <h3>راهنمای کامل گندم</h3>
                <p>نیازهای کودی، زمان مناسب کاشت و برداشت، آفات و بیماری‌های رایج گندم</p>
                <button class="secondary" onclick="showProductDetail('wheat')">مشاهده جزئیات</button>
            </div>
            <div class="feature-card">
                <i class="fas fa-book-open"></i>
                <h3>راهنمای کامل ذرت</h3>
                <p>نیازهای آبیاری، کودهای مناسب، روش‌های افزایش عملکرد ذرت</p>
                <button class="secondary" onclick="showProductDetail('corn')">مشاهده جزئیات</button>
            </div>
            <div class="feature-card">
                <i class="fas fa-book-open"></i>
                <h3>راهنمای کامل سیب‌زمینی</h3>
                <p>مدیریت کوددهی، کنترل آفات، روش‌های نگهداری سیب‌زمینی</p>
                <button class="secondary" onclick="showProductDetail('potato')">مشاهده جزئیات</button>
            </div>
        </div>
    </section>

    <!-- Tab 4: Fertilizers Guide -->
    <section id="fertilizers" class="form-section">
        <h3>انواع کودهای شیمیایی</h3>
        <div class="product-card">
            <h4><i class="fas fa-flask"></i> کودهای نیتروژنی</h4>
            <p>کودهای حاوی نیتروژن که برای رشد سبزینه گیاهان ضروری هستند.</p>
            <ul>
                <li>اوره (46% نیتروژن)</li>
                <li>نیترات آمونیوم (34% نیتروژن)</li>
                <li>سولفات آمونیوم (21% نیتروژن)</li>
            </ul>
        </div>
        <div class="product-card">
            <h4><i class="fas fa-flask"></i> کودهای فسفاتی</h4>
            <p>کودهای حاوی فسفر که برای رشد ریشه و تشکیل گل و میوه مهم هستند.</p>
            <ul>
                <li>سوپرفسفات تریپل (46% P₂O₅)</li>
                <li>سوپرفسفات ساده (20% P₂O₅)</li>
                <li>دی آمونیوم فسفات (46% P₂O₅)</li>
            </ul>
        </div>
    </section>

    <div class="footer">
        <div class="container">
            <p><i class="fas fa-phone"></i> پشتیبانی: 021-12345678</p>
            <p><i class="fas fa-envelope"></i> ایمیل: info@agriadvisor.ir</p>
            <p><i class="fas fa-map-marker-alt"></i> آدرس: تهران، خیابان آزادی</p>
            <div class="social-icons">
                <a href="#"><i class="fab fa-telegram"></i></a>
                <a href="#"><i class="fab fa-instagram"></i></a>
                <a href="#"><i class="fab fa-whatsapp"></i></a>
                <a href="#"><i class="fab fa-youtube"></i></a>
            </div>
            <p>© 2023 AgriAdvisor Pro - تمام حقوق محفوظ است</p>
        </div>
    </div>

    <div class="notification" id="notification"></div>
</div>

<!-- Chart.js & Toastify Scripts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js "></script>
<script src="https://cdn.jsdelivr.net/npm/toastify-js "></script>

<!-- Main Script -->
<script>
    let costChart, adviceChart;
    const plantNeeds = {
        wheat: { N: 100, P: 60, K: 50, description: "گندم به نیتروژن برای رشد ساقه و برگ نیاز دارد." },
        corn: { N: 150, P: 80, K: 70, description: "ذرت به نیتروژن زیادی نیاز دارد. کمبود باعث زردی برگ می‌شود." },
        potato: { N: 120, P: 90, K: 150, description: "سیب‌زمینی به پتاسیم زیادی نیاز دارد." },
        tomato: { N: 130, P: 70, K: 140, description: "گوجه فرنگی در مراحل مختلف نیازهای غذایی متفاوتی دارد." },
        rice: { N: 110, P: 50, K: 80, description: "برنج در خاک غرقاب نیاز به مدیریت خاص کود دارد." },
        cotton: { N: 140, P: 60, K: 90, description: "پنبه به نیتروژن برای تشکیل غوزه نیاز دارد." }
    };

    const savedCalculations = JSON.parse(localStorage.getItem('savedCalculations')) || [];

    function toggleDarkMode() {
        document.body.classList.toggle('dark-mode');
        localStorage.setItem('darkMode', document.body.classList.contains('dark-mode') ? 'enabled' : 'disabled');
        showNotification(document.body.classList.contains('dark-mode') ? 'حالت تاریک فعال شد' : 'حالت روشن فعال شد');
    }

    if (localStorage.getItem('darkMode') === 'enabled') {
        document.body.classList.add('dark-mode');
        document.querySelector('.dark-mode-toggle i').classList.replace('fa-moon', 'fa-sun');
    }

    function showNotification(message, type = 'success') {
        const notification = document.getElementById('notification');
        notification.textContent = message;
        notification.className = 'notification show';
        notification.style.background = type === 'error' ? 'var(--error)' : 'var(--success)';
        setTimeout(() => notification.classList.remove('show'), 3000);
    }

    function switchTab(tabEl, sectionId) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.form-section').forEach(s => s.classList.remove('active'));
        tabEl.classList.add('active');
        document.getElementById(sectionId).classList.add('active');
        document.getElementById(sectionId).scrollIntoView({ behavior: 'smooth' });
    }

    function calculate() {
        const area = parseFloat(document.getElementById("area").value);
        const crop = document.getElementById("cropCost").value.split('-')[0].trim();
        const cropRate = { wheat: 100, corn: 120, barley: 80, potato: 150, tomato: 130 }[crop];
        const price = parseFloat(document.getElementById("pricePerKilo").value);
        const discount = parseFloat(document.getElementById("discount").value) || 0;

        if (isNaN(area)) return showNotification("مساحت زمین را وارد کنید", "error");
        if (isNaN(price)) return showNotification("قیمت کود را وارد کنید", "error");

        const totalKg = area * cropRate;
        const totalPrice = totalKg * price;
        const discountedPrice = totalPrice * (1 - discount / 100);

        document.getElementById("costResult").innerHTML = `
            <h3><i class="fas fa-chart-bar"></i> نتایج محاسبه</h3>
            <p><i class="fas fa-weight-hanging"></i> مجموع کود: ${totalKg.toFixed(2)} کیلوگرم</p>
            <p><i class="fas fa-tag"></i> قیمت قبل از تخفیف: ${totalPrice.toLocaleString()} تومان</p>
            ${discount > 0 ? `<p><i class="fas fa-percentage"></i> تخفیف: ${discount}%</p>` : ''}
            <p><i class="fas fa-money-bill-wave"></i> قیمت نهایی: ${discountedPrice.toLocaleString()} تومان</p>
        `;

        if (costChart) costChart.destroy();
        const ctx = document.getElementById('costChart').getContext('2d');
        costChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['کود (کیلو)', 'هزینه (تومان)'],
                datasets: [{
                    label: 'مقایسه',
                    data: [totalKg, discountedPrice],
                    backgroundColor: ['#4caf50', '#2196f3']
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        ticks: { callback: v => v.toLocaleString() }
                    }
                }
            }
        });
    }

    function getAdvice() {
        const plant = document.getElementById("plant").value;
        const soil = document.getElementById("soilType").value;
        const ph = parseFloat(document.getElementById("soilPh").value);
        const climate = document.getElementById("climate").value;
        const season = document.getElementById("season").value;
        const needs = plantNeeds[plant];
        const advice = [];

        if (ph < 6) advice.push("استفاده از کودهای آمونیومی برای بالا بردن pH");
        if (soil === "sandy") advice.push("خاک شنی، کوددهی چندباره و کم توصیه می‌شود.");
        if (climate === "dry") advice.push("در مناطق خشک، استفاده از کودهای آلی مناسب‌تر است.");
        if (plant === "corn" && season === "summer") advice.push("ذرت در تابستان به نیتروژن زیادی نیاز دارد.");

        document.getElementById("adviceResult").innerHTML = `
            <h3><i class="fas fa-info-circle"></i> مشاوره کود مناسب</h3>
            <p>${needs.description}</p>
            <ul>${advice.map(a => `<li>${a}</li>`).join('')}</ul>
        `;

        if (adviceChart) adviceChart.destroy();
        const ctx = document.getElementById('adviceChart').getContext('2d');
        adviceChart = new Chart(ctx, {
            type: 'radar',
            data: {
                labels: ['نیتروژن', 'فسفر', 'پتاسیم'],
                datasets: [{
                    label: 'نیاز گیاه',
                    data: [needs.N, needs.P, needs.K],
                    backgroundColor: 'rgba(46, 125, 50, 0.3)',
                    borderColor: '#2e7d32'
                }]
            },
            options: { scale: { ticks: { beginAtZero: true } } }
        });
    }

    function saveCalculation() {
        const resultDiv = document.getElementById("costResult");
        if (!resultDiv.innerHTML.includes("نتایج محاسبه")) {
            showNotification("ابتدا محاسبه را انجام دهید.", "error");
            return;
        }
        const calculation = {
            id: Date.now(),
            resultHTML: resultDiv.innerHTML
        };
        savedCalculations.push(calculation);
        localStorage.setItem('savedCalculations', JSON.stringify(savedCalculations));
        showNotification("محاسبه ذخیره شد", "success");
    }

    function printAdvice() {
        const content = document.getElementById("adviceResult").innerHTML;
        const win = window.open('', '', 'height=600,width=800');
        win.document.write('<html><head><title>چاپ مشاوره</title></head><body>');
        win.document.write(content);
        win.document.write('</body></html>');
        win.document.close();
        win.print();
    }

    function searchProducts() {
        const query = document.getElementById("productSearch").value.toLowerCase();
        const results = Object.keys(plantNeeds).filter(k => k.includes(query));
        const container = document.getElementById("searchResults");
        container.innerHTML = results.map(r => `<li onclick="showProductDetail('${r}')">${r}</li>`).join('');
    }

    function showProductDetail(product) {
        const info = plantNeeds[product];
        Toastify({
            text: `N=${info.N}, P=${info.P}, K=${info.K}`,
            duration: 5000,
            gravity: "bottom",
            backgroundColor: "#4caf50"
        }).showToast();
    }
</script>
</body>
</html>