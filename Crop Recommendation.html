<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سیستم پیشنهاد محصول کشاورزی</title>
    <style>
       /* وارد کردن فونت وزیر از CDN */
@import url('https://cdn.fontcdn.ir/Font/Persian/Vazir/Vazir.css');

/* ریست استایل‌های پیش‌فرض */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

/* استایل کلی بدنه */
body {
    font-family: 'Vazir', Arial, sans-serif;
    background-color: #f4f4f9;
    color: #2c3e50;
    line-height: 1.6;
    padding: 20px;
    direction: rtl;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
}

/* کانتینر اصلی */
.container {
    max-width: 900px;
    width: 100%;
    background: #ffffff;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    padding: 30px;
    margin: 20px auto;
    transition: all 0.3s ease;
}

/* تیترها */
h1, h2 {
    text-align: center;
    color: #2c3e50;
    margin-bottom: 20px;
}

h1 {
    font-size: 2rem;
    font-weight: 700;
}

h2 {
    font-size: 1.5rem;
    font-weight: 500;
}

/* فرم‌ها */
.form-group {
    margin-bottom: 20px;
}

label {
    display: block;
    font-size: 1rem;
    font-weight: 500;
    color: #2c3e50;
    margin-bottom: 8px;
}

input, select {
    width: 100%;
    padding: 12px;
    border: 1px solid #d1d5db;
    border-radius: 8px;
    font-size: 1rem;
    font-family: 'Vazir', sans-serif;
    background-color: #f9fafb;
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
}

input:focus, select:focus {
    outline: none;
    border-color: #28a745;
    box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.1);
}

/* فرم پیشرفته */
.advanced-form {
    display: none;
    background: #f9fafb;
    padding: 20px;
    border-radius: 8px;
    margin-top: 20px;
    animation: fadeIn 0.5s ease-in-out;
}

/* انیمیشن برای فرم پیشرفته */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* گروه دکمه‌ها */
.button-group {
    display: flex;
    gap: 15px;
    justify-content: center;
    margin: 20px 0;
}

button {
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 500;
    font-family: 'Vazir', sans-serif;
    cursor: pointer;
    transition: background-color 0.3s ease, transform 0.2s ease;
}

button:hover {
    transform: translateY(-2px);
}

button[type="submit"] {
    background-color: #28a745;
    color: #ffffff;
}

button[type="submit"]:hover {
    background-color: #218838;
}

button.clear {
    background-color: #dc3545;
}

button.clear:hover {
    background-color: #c82333;
}

button.download {
    background-color: #007bff;
}

button.download:hover {
    background-color: #0056b3;
}

/* نتایج */
#results {
    margin-top: 30px;
    display: grid;
    gap: 15px;
}

.result-item {
    background: #ffffff;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    transition: transform 0.3s ease;
}

.result-item:hover {
    transform: translateY(-5px);
}

.result-item h3 {
    font-size: 1.2rem;
    font-weight: 700;
    color: #2c3e50;
    margin-bottom: 10px;
}

.result-item p {
    font-size: 0.95rem;
    color: #4b5563;
    margin-bottom: 8px;
}

/* پیام خطا */
.error {
    color: #dc3545;
    font-size: 0.9rem;
    text-align: center;
    margin-top: 10px;
}

/* نمودار */
canvas {
    margin-top: 30px;
    max-width: 100%;
    border-radius: 8px;
    background: #ffffff;
    padding: 10px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
}

/* پشتیبانی از تم تیره */
@media (prefers-color-scheme: dark) {
    body {
        background-color: #1f2a44;
        color: #ecf0f1;
    }

    .container {
        background: #2d3748;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }

    input, select {
        background-color: #374151;
        color: #ecf0f1;
        border-color: #4b5563;
    }

    input:focus, select:focus {
        border-color: #28a745;
        box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.3);
    }

    .advanced-form {
        background: #374151;
    }

    .result-item {
        background: #374151;
        border-color: #4b5563;
    }

    .result-item h3 {
        color: #ecf0f1;
    }

    .result-item p {
        color: #d1d5db;
    }

    canvas {
        background: #374151;
    }
}

/* واکنش‌گرایی */
@media (max-width: 768px) {
    .container {
        padding: 15px;
    }

    h1 {
        font-size: 1.5rem;
    }

    h2 {
        font-size: 1.2rem;
    }

    button {
        padding: 10px 20px;
        font-size: 0.9rem;
    }

    .button-group {
        flex-direction: column;
        gap: 10px;
    }
}

@media (max-width: 480px) {
    input, select {
        font-size: 0.9rem;
        padding: 10px;
    }

    .result-item {
        padding: 15px;
    }
}
    </style>
</head>
<body>
    <div class="container">
        <h1>سیستم پیشنهاد محصول کشاورزی</h1>
        <form id="inputForm">
            <h2>ورودی‌های پایه</h2>
            <div class="form-group">
                <label for="tempMin">دمای حداقل (درجه سانتی‌گراد):</label>
                <input type="number" id="tempMin" placeholder="مثال: 10" step="0.1">
            </div>
            <div class="form-group">
                <label for="tempMax">دمای حداکثر (درجه سانتی‌گراد):</label>
                <input type="number" id="tempMax" placeholder="مثال: 30" step="0.1">
            </div>
            <div class="form-group">
                <label for="rainfall">میزان بارندگی سالیانه (میلی‌متر):</label>
                <input type="number" id="rainfall" placeholder="مثال: 500" step="1">
            </div>
            <div class="form-group">
                <label for="ph">pH خاک:</label>
                <input type="number" id="ph" placeholder="مثال: 6.5" step="0.1" min="0" max="14">
            </div>
            <div class="form-group">
                <label for="texture">بافت خاک:</label>
                <select id="texture">
                    <option value="">انتخاب کنید (اختیاری)</option>
                    <option value="لومی">لومی</option>
                    <option value="رسی">رسی</option>
                    <option value="شنی">شنی</option>
                </select>
            </div>
            <div class="form-group">
                <label for="season">فصل کاشت:</label>
                <select id="season">
                    <option value="">انتخاب کنید (اختیاری)</option>
                    <option value="بهار">بهار</option>
                    <option value="تابستان">تابستان</option>
                    <option value="پاییز">پاییز</option>
                    <option value="زمستان">زمستان</option>
                </select>
            </div>
            <div class="form-group">
                <label for="cultivationType">نوع کشت:</label>
                <select id="cultivationType">
                    <option value="">انتخاب کنید (اختیاری)</option>
                    <option value="زراعی">زراعی</option>
                    <option value="باغی">باغی</option>
                    <option value="گلخانه‌ای">گلخانه‌ای</option>
                </select>
            </div>
            <div class="form-group">
                <label for="area">مساحت زمین (هکتار):</label>
                <input type="number" id="area" placeholder="مثال: 1" step="0.1" min="0">
            </div>
            <div class="form-group">
                <label for="latitude">عرض جغرافیایی:</label>
                <input type="number" id="latitude" placeholder="مثال: 35.7" step="0.1">
            </div>
            <div class="form-group">
                <label for="longitude">طول جغرافیایی:</label>
                <input type="number" id="longitude" placeholder="مثال: 51.4" step="0.1">
            </div>
            <button type="button" onclick="toggleAdvancedForm()">نمایش/مخفی کردن ورودی‌های پیشرفته</button>
            <div id="advancedForm" class="advanced-form">
                <h2>ورودی‌های پیشرفته (خاک و اقلیم)</h2>
                <div class="form-group">
                    <label for="humidity">رطوبت نسبی (%):</label>
                    <input type="number" id="humidity" placeholder="مثال: 60" step="1" min="0" max="100">
                </div>
                <div class="form-group">
                    <label for="altitude">ارتفاع از سطح دریا (متر):</label>
                    <input type="number" id="altitude" placeholder="مثال: 1200" step="1">
                </div>
                <div class="form-group">
                    <label for="sunHours">ساعات آفتابی روزانه:</label>
                    <input type="number" id="sunHours" placeholder="مثال: 8" step="0.1">
                </div>
                <div class="form-group">
                    <label for="nitrogen">نیتروژن خاک (mg/kg):</label>
                    <input type="number" id="nitrogen" placeholder="مثال: 20" step="0.1">
                </div>
                <div class="form-group">
                    <label for="phosphorus">فسفر خاک (mg/kg):</label>
                    <input type="number" id="phosphorus" placeholder="مثال: 15" step="0.1">
                </div>
                <div class="form-group">
                    <label for="potassium">پتاسیم خاک (mg/kg):</label>
                    <input type="number" id="potassium" placeholder="مثال: 200" step="1">
                </div>
                <div class="form-group">
                    <label for="organicCarbon">کربن آلی خاک (%):</label>
                    <input type="number" id="organicCarbon" placeholder="مثال: 1.5" step="0.1">
                </div>
                <div class="form-group">
                    <label for="ec">شوری خاک (EC, dS/m):</label>
                    <input type="number" id="ec" placeholder="مثال: 0.5" step="0.1">
                </div>
                <div class="form-group">
                    <label for="waterHolding">ظرفیت نگهداری آب خاک (%):</label>
                    <input type="number" id="waterHolding" placeholder="مثال: 30" step="1">
                </div>
                <div class="form-group">
                    <label for="calcium">کلسیم خاک (mg/kg):</label>
                    <input type="number" id="calcium" placeholder="مثال: 1000" step="1">
                </div>
                <div class="form-group">
                    <label for="magnesium">منیزیم خاک (mg/kg):</label>
                    <input type="number" id="magnesium" placeholder="مثال: 200" step="1">
                </div>
                <div class="form-group">
                    <label for="iron">آهن خاک (mg/kg):</label>
                    <input type="number" id="iron" placeholder="مثال: 5" step="0.1">
                </div>
                <div class="form-group">
                    <label for="zinc">روی خاک (mg/kg):</label>
                    <input type="number" id="zinc" placeholder="مثال: 2" step="0.1">
                </div>
            </div>
            <div class="button-group">
                <button type="submit">پیشنهاد محصول</button>
                <button type="button" class="clear" onclick="clearForm()">پاک کردن فرم</button>
                <button type="button" class="download" onclick="downloadPDF()">دانلود گزارش (PDF)</button>
            </div>
            <div id="error" class="error"></div>
        </form>
        <div id="results"></div>
        <canvas id="successChart"></canvas>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        // پایگاه داده محصولات (50 محصول - برای نمونه چند مورد ذکر شده)
        const products = [
            { name: "گندم", category: "غلات", cultivationType: "زراعی", climate: { temp_min: 10, temp_max: 30, rainfall: 400, humidity: 50, altitude: 1000, sunHours: 6 }, soil: { ph_min: 6, ph_max: 7.5, texture: ["لومی", "رسی"], nitrogen: 20, phosphorus: 15, potassium: 150, organicCarbon: 1, ec: 0.5, waterHolding: 30, calcium: 1000, magnesium: 200, iron: 5, zinc: 2 }, season: ["بهار", "پاییز"], yield_per_hectare: 4000, seed_needed: 150, fertilizer_needed: { N: 100, P: 50, K: 40 }, water_needed: 500 },
            { name: "برنج", category: "غلات", cultivationType: "زراعی", climate: { temp_min: 20, temp_max: 35, rainfall: 1000, humidity: 70, altitude: 500, sunHours: 7 }, soil: { ph_min: 5.5, ph_max: 7, texture: ["رسی"], nitrogen: 25, phosphorus: 20, potassium: 200, organicCarbon: 1.5, ec: 0.7, waterHolding: 40, calcium: 1200, magnesium: 250, iron: 6, zinc: 2.5 }, season: ["تابستان"], yield_per_hectare: 5000, seed_needed: 100, fertilizer_needed: { N: 120, P: 60, K: 50 }, water_needed: 1500 },
            { name: "ذرت", category: "غلات", cultivationType: "زراعی", climate: { temp_min: 18, temp_max: 32, rainfall: 600, humidity: 60, altitude: 800, sunHours: 8 }, soil: { ph_min: 5.8, ph_max: 7.2, texture: ["لومی"], nitrogen: 30, phosphorus: 20, potassium: 180, organicCarbon: 1.2, ec: 0.6, waterHolding: 35, calcium: 1100, magnesium: 220, iron: 5.5, zinc: 2.2 }, season: ["بهار", "تابستان"], yield_per_hectare: 6000, seed_needed: 25, fertilizer_needed: { N: 150, P: 70, K: 60 }, water_needed: 800 },
            { name: "جو", category: "غلات", cultivationType: "زراعی", climate: { temp_min: 8, temp_max: 28, rainfall: 350, humidity: 50, altitude: 1000, sunHours: 6 }, soil: { ph_min: 6, ph_max: 7.5, texture: ["لومی", "شنی"], nitrogen: 20, phosphorus: 15, potassium: 150, organicCarbon: 1, ec: 0.5, waterHolding: 30, calcium: 1000, magnesium: 200, iron: 5, zinc: 2 }, season: ["پاییز"], yield_per_hectare: 3500, seed_needed: 120, fertilizer_needed: { N: 90, P: 40, K: 30 }, water_needed: 400 },
            { name: "سیب‌زمینی", category: "سبزیجات", cultivationType: "زراعی", climate: { temp_min: 15, temp_max: 25, rainfall: 500, humidity: 60, altitude: 800, sunHours: 7 }, soil: { ph_min: 5.5, ph_max: 6.5, texture: ["شنی", "لومی"], nitrogen: 25, phosphorus: 20, potassium: 200, organicCarbon: 1.5, ec: 0.6, waterHolding: 35, calcium: 1200, magnesium: 250, iron: 6, zinc: 2.5 }, season: ["بهار"], yield_per_hectare: 30000, seed_needed: 2000, fertilizer_needed: { N: 120, P: 80, K: 100 }, water_needed: 600 },
            // ... 45 محصول دیگر به همین ساختار اضافه شوند (برای جلوگیری از طولانی شدن، فقط نمونه ذکر شده)
        ];

        // تابع نمایش/مخفی کردن فرم پیشرفته
        function toggleAdvancedForm() {
            const advancedForm = document.getElementById('advancedForm');
            advancedForm.style.display = advancedForm.style.display === 'none' ? 'block' : 'none';
        }

        // تابع پاک کردن فرم
        function clearForm() {
            document.getElementById('inputForm').reset();
            document.getElementById('results').innerHTML = '';
            document.getElementById('error').innerHTML = '';
            const ctx = document.getElementById('successChart').getContext('2d');
            ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
        }

        // تابع اعتبارسنجی ورودی‌ها
        function validateInput(userInput) {
            const errorDiv = document.getElementById('error');
            errorDiv.innerHTML = '';
            if (userInput.ph && (userInput.ph < 0 || userInput.ph > 14)) {
                errorDiv.innerHTML = 'pH خاک باید بین 0 تا 14 باشد.';
                return false;
            }
            if (userInput.humidity && (userInput.humidity < 0 || userInput.humidity > 100)) {
                errorDiv.innerHTML = 'رطوبت نسبی باید بین 0 تا 100 باشد.';
                return false;
            }
            if (userInput.area && userInput.area < 0) {
                errorDiv.innerHTML = 'مساحت زمین نمی‌تواند منفی باشد.';
                return false;
            }
            return true;
        }

        // تابع محاسبه درصد تطبیق (مقیاس‌پذیر)
        function calculateMatchScore(userInput, product) {
            let score = 0;
            const weights = {
                climate: { temp: 15, rainfall: 10, humidity: 5, altitude: 5, sunHours: 5 },
                soil: { ph: 10, texture: 5, nitrogen: 5, phosphorus: 5, potassium: 5, organicCarbon: 5, ec: 5, waterHolding: 5, calcium: 5, magnesium: 5, iron: 5, zinc: 5 },
                season: 10,
                cultivationType: 10
            };

            // اقلیم
            if (userInput.tempMin && userInput.tempMax && userInput.tempMin >= product.climate.temp_min && userInput.tempMax <= product.climate.temp_max) {
                score += weights.climate.temp;
            }
            if (userInput.rainfall && Math.abs(userInput.rainfall - product.climate.rainfall) <= 200) {
                score += weights.climate.rainfall;
            }
            if (userInput.humidity && Math.abs(userInput.humidity - product.climate.humidity) <= 20) {
                score += weights.climate.humidity;
            }
            if (userInput.altitude && Math.abs(userInput.altitude - product.climate.altitude) <= 500) {
                score += weights.climate.altitude;
            }
            if (userInput.sunHours && Math.abs(userInput.sunHours - product.climate.sunHours) <= 2) {
                score += weights.climate.sunHours;
            }

            // خاک
            if (userInput.ph && userInput.ph >= product.soil.ph_min && userInput.ph <= product.soil.ph_max) {
                score += weights.soil.ph;
            }
            if (userInput.texture && product.soil.texture.includes(userInput.texture)) {
                score += weights.soil.texture;
            }
            if (userInput.nitrogen && Math.abs(userInput.nitrogen - product.soil.nitrogen) <= 10) {
                score += weights.soil.nitrogen;
            }
            if (userInput.phosphorus && Math.abs(userInput.phosphorus - product.soil.phosphorus) <= 10) {
                score += weights.soil.phosphorus;
            }
            if (userInput.potassium && Math.abs(userInput.potassium - product.soil.potassium) <= 50) {
                score += weights.soil.potassium;
            }
            if (userInput.organicCarbon && Math.abs(userInput.organicCarbon - product.soil.organicCarbon) <= 0.5) {
                score += weights.soil.organicCarbon;
            }
            if (userInput.ec && Math.abs(userInput.ec - product.soil.ec) <= 0.2) {
                score += weights.soil.ec;
            }
            if (userInput.waterHolding && Math.abs(userInput.waterHolding - product.soil.waterHolding) <= 10) {
                score += weights.soil.waterHolding;
            }
            if (userInput.calcium && Math.abs(userInput.calcium - product.soil.calcium) <= 200) {
                score += weights.soil.calcium;
            }
            if (userInput.magnesium && Math.abs(userInput.magnesium - product.soil.magnesium) <= 50) {
                score += weights.soil.magnesium;
            }
            if (userInput.iron && Math.abs(userInput.iron - product.soil.iron) <= 2) {
                score += weights.soil.iron;
            }
            if (userInput.zinc && Math.abs(userInput.zinc - product.soil.zinc) <= 1) {
                score += weights.soil.zinc;
            }

            // فصل
            if (userInput.season && product.season.includes(userInput.season)) {
                score += weights.season;
            }

            // نوع کشت
            if (userInput.cultivationType && product.cultivationType === userInput.cultivationType) {
                score += weights.cultivationType;
            }

            return score;
        }

        // تابع توصیه‌های بهبود (مقیاس‌پذیر)
        function recommendImprovements(userInput, product) {
            const improvements = [];
            if (userInput.ph) {
                if (userInput.ph < product.soil.ph_min) {
                    improvements.push(`افزایش pH خاک با افزودن آهک (هدف: ${product.soil.ph_min}-${product.soil.ph_max})`);
                } else if (userInput.ph > product.soil.ph_max) {
                    improvements.push(`کاهش pH خاک با افزودن گوگرد (هدف: ${product.soil.ph_min}-${product.soil.ph_max})`);
                }
            }
            if (userInput.rainfall && userInput.rainfall < product.climate.rainfall - 200) {
                improvements.push(`افزایش آبیاری برای جبران کمبود بارندگی (هدف: ${product.climate.rainfall} میلی‌متر)`);
            }
            if (userInput.nitrogen && userInput.nitrogen < product.soil.nitrogen) {
                improvements.push(`افزودن کود نیتروژنی (هدف: ${product.soil.nitrogen} mg/kg)`);
            }
            if (userInput.phosphorus && userInput.phosphorus < product.soil.phosphorus) {
                improvements.push(`افزودن کود فسفری (هدف: ${product.soil.phosphorus} mg/kg)`);
            }
            if (userInput.potassium && userInput.potassium < product.soil.potassium) {
                improvements.push(`افزودن کود پتاسیمی (هدف: ${product.soil.potassium} mg/kg)`);
            }
            return improvements;
        }

        // تابع پیش‌بینی برداشت و مواد مورد نیاز (مقیاس‌پذیر)
        function predictYieldAndNeeds(product, area) {
            return {
                yield: product.yield_per_hectare * area,
                seed: product.seed_needed * area,
                fertilizer: {
                    N: product.fertilizer_needed.N * area,
                    P: product.fertilizer_needed.P * area,
                    K: product.fertilizer_needed.K * area
                },
                water: product.water_needed * area
            };
        }

        // تابع دانلود PDF
        function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.setFont("Arial", "normal");
            doc.setFontSize(12);
            doc.text("گزارش پیشنهاد محصول کشاورزی", 10, 10);

            const results = document.getElementById('results').innerHTML;
            const recommendations = Array.from(document.querySelectorAll('.result-item')).map(item => {
                return item.innerText.replace(/\n/g, '\n');
            });

            let y = 20;
            recommendations.forEach(rec => {
                doc.text(rec, 10, y);
                y += 30;
                if (y > 280) {
                    doc.addPage();
                    y = 10;
                }
            });

            doc.save("گزارش_محصولات_کشاورزی.pdf");
        }

        // مدیریت فرم
        document.getElementById('inputForm').addEventListener('submit', function (e) {
            e.preventDefault();

            // دریافت ورودی‌ها
            const userInput = {
                tempMin: parseFloat(document.getElementById('tempMin').value) || 10,
                tempMax: parseFloat(document.getElementById('tempMax').value) || 30,
                rainfall: parseFloat(document.getElementById('rainfall').value) || 500,
                humidity: parseFloat(document.getElementById('humidity').value) || 60,
                altitude: parseFloat(document.getElementById('altitude').value) || 1000,
                sunHours: parseFloat(document.getElementById('sunHours').value) || 7,
                ph: parseFloat(document.getElementById('ph').value) || 6.5,
                texture: document.getElementById('texture').value || 'لومی',
                nitrogen: parseFloat(document.getElementById('nitrogen').value) || 20,
                phosphorus: parseFloat(document.getElementById('phosphorus').value) || 15,
                potassium: parseFloat(document.getElementById('potassium').value) || 150,
                organicCarbon: parseFloat(document.getElementById('organicCarbon').value) || 1,
                ec: parseFloat(document.getElementById('ec').value) || 0.5,
                waterHolding: parseFloat(document.getElementById('waterHolding').value) || 30,
                calcium: parseFloat(document.getElementById('calcium').value) || 1000,
                magnesium: parseFloat(document.getElementById('magnesium').value) || 200,
                iron: parseFloat(document.getElementById('iron').value) || 5,
                zinc: parseFloat(document.getElementById('zinc').value) || 2,
                season: document.getElementById('season').value || 'بهار',
                cultivationType: document.getElementById('cultivationType').value || 'زراعی',
                area: parseFloat(document.getElementById('area').value) || 1,
                latitude: parseFloat(document.getElementById('latitude').value) || 35.7,
                longitude: parseFloat(document.getElementById('longitude').value) || 51.4
            };

            // اعتبارسنجی
            if (!validateInput(userInput)) {
                return;
            }

            try {
                // پردازش پیشنهادات
                const recommendations = [];
                products.forEach(product => {
                    const score = calculateMatchScore(userInput, product);
                    if (score > 50) {
                        const improvements = recommendImprovements(userInput, product);
                        const prediction = predictYieldAndNeeds(product, userInput.area);
                        recommendations.push({
                            product: product.name,
                            category: product.category,
                            success_rate: score,
                            improvements: improvements,
                            prediction: prediction
                        });
                    }
                });

                // نمایش نتایج
                const resultsDiv = document.getElementById('results');
                resultsDiv.innerHTML = '';
                if (recommendations.length === 0) {
                    resultsDiv.innerHTML = '<p>هیچ محصولی با شرایط وارد شده یافت نشد.</p>';
                    return;
                }

                recommendations.forEach(rec => {
                    const resultItem = document.createElement('div');
                    resultItem.className = 'result-item';
                    resultItem.innerHTML = `
                        <h3>محصول: ${rec.product} (${rec.category})</h3>
                        <p>درصد موفقیت: ${rec.success_rate.toFixed(2)}%</p>
                        <p>توصیه‌های بهبود: ${rec.improvements.length ? rec.improvements.join(', ') : 'نیازی به بهبود نیست'}</p>
                        <p>پیش‌بینی برداشت: ${rec.prediction.yield.toFixed(2)} کیلوگرم</p>
                        <p>بذر مورد نیاز: ${rec.prediction.seed.toFixed(2)} کیلوگرم</p>
                        <p>کود مورد نیاز: نیتروژن: ${rec.prediction.fertilizer.N.toFixed(2)} کیلوگرم، فسفر: ${rec.prediction.fertilizer.P.toFixed(2)} کیلوگرم، پتاسیم: ${rec.prediction.fertilizer.K.toFixed(2)} کیلوگرم</p>
                        <p>آب مورد نیاز: ${rec.prediction.water.toFixed(2)} میلی‌متر</p>
                    `;
                    resultsDiv.appendChild(resultItem);
                });

                // تولید نمودار
                const ctx = document.getElementById('successChart').getContext('2d');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: recommendations.map(rec => rec.product),
                        datasets: [{
                            label: 'درصد موفقیت',
                            data: recommendations.map(rec => rec.success_rate),
                            backgroundColor: ['#36A2EB', '#FF6384', '#FFCE56', '#4BC0C0', '#9966FF'],
                            borderColor: ['#36A2EB', '#FF6384', '#FFCE56', '#4BC0C0', '#9966FF'],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                title: {
                                    display: true,
                                    text: 'درصد موفقیت'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'محصولات'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: true
                            },
                            title: {
                                display: true,
                                text: 'درصد موفقیت محصولات پیشنهادی'
                            }
                        }
                    }
                });
            } catch (error) {
                document.getElementById('error').innerHTML = 'خطایی رخ داد: ' + error.message;
            }
        });
    </script>
</body>
</html>