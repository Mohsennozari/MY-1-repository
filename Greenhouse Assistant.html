<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¯Ø³ØªÛŒØ§Ø± Ú¯Ù„Ø®Ø§Ù†Ù‡ Ù‡ÙˆØ´Ù…Ù†Ø¯</title>
    <style>
        :root {
            --primary: #2E7D32; /* Ø³Ø¨Ø² Ø²ÛŒØªÙˆÙ†ÛŒ */
            --secondary: #4FC3F7; /* Ø¢Ø¨ÛŒ Ø¢Ø³Ù…Ø§Ù†ÛŒ */
            --accent: #FF7043; /* Ù†Ø§Ø±Ù†Ø¬ÛŒ Ú¯Ø±Ù… */
            --background: #F5F5F5;
            --card: #FFFFFF;
            --text: #1A1A1A;
            --border: #E0E0E0;
            --dark-bg: #121212;
            --dark-card: #1E1E1E;
            --dark-text: #E0E0E0;
            --dark-border: #333;
        }
        body {
            font-family: 'Vazir', -apple-system, sans-serif;
            margin: 0;
            padding: 20px;
            background: var(--background);
            color: var(--text);
            transition: all 0.3s ease;
            line-height: 1.6;
        }
        body.dark-mode {
            background: var(--dark-bg);
            color: var(--dark-text);
        }
        body.dark-mode .container, body.dark-mode .dashboard, body.dark-mode .tabcontent {
            background: var(--dark-card);
            border-color: var(--dark-border);
        }
        body.dark-mode input, body.dark-mode select {
            background: #2C2C2C;
            color: var(--dark-text);
            border-color: var(--dark-border);
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: var(--card);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            animation: fadeIn 0.5s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        h1 {
            text-align: center;
            font-size: 32px;
            font-weight: 700;
            color: var(--primary);
            margin: 0 0 20px;
        }
        .dashboard {
            background: linear-gradient(135deg, #e8f5e9, #e3f2fd);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }
        .dashboard p {
            margin: 5px 0;
            font-size: 16px;
            color: var(--text);
        }
        .tab {
            display: flex;
            background: var(--card);
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        .tab button {
            flex: 1;
            padding: 15px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            color: var(--text);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .tab button:hover, .tab button.active {
            background: var(--primary);
            color: #FFFFFF;
        }
        .tabcontent {
            padding: 25px;
            border: 1px solid var(--border);
            border-top: none;
            border-radius: 0 0 15px 15px;
            background: var(--card);
            animation: fadeIn 0.3s ease;
        }
        .form-group {
            margin-bottom: 20px;
            position: relative;
        }
        label {
            display: block;
            font-weight: 500;
            color: var(--text);
            margin-bottom: 8px;
        }
        select, input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 10px;
            font-size: 16px;
            background: var(--card);
            color: var(--text);
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        select:focus, input:focus {
            border-color: var(--secondary);
            box-shadow: 0 0 5px rgba(79, 195, 247, 0.3);
            outline: none;
        }
        .tooltip {
            position: absolute;
            top: -30px;
            left: 10px;
            background: var(--secondary);
            color: #FFFFFF;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            display: none;
            z-index: 10;
        }
        .form-group:hover .tooltip {
            display: block;
        }
        button.submit-btn {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            color: #FFFFFF;
            padding: 14px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            width: 100%;
            transition: transform 0.2s, box-shadow 0.2s;
            opacity: 0.5;
        }
        button.submit-btn.enabled {
            opacity: 1;
            cursor: pointer;
        }
        button.submit-btn.enabled:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        .error {
            color: var(--accent);
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
        #result, #history {
            margin-top: 20px;
            padding: 20px;
            border-radius: 10px;
            background: var(--card);
            border: 1px solid var(--border);
        }
        .history-item {
            padding: 15px;
            border-bottom: 1px solid var(--border);
            transition: background 0.2s;
        }
        .history-item:hover {
            background: #e3f2fd;
        }
        .theme-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            background: var(--primary);
            color: #FFFFFF;
            border: none;
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        @media (max-width: 600px) {
            .container { padding: 15px; }
            h1 { font-size: 24px; }
            .tab button { font-size: 14px; padding: 10px; }
        }
    </style>
</head>
<body>
    <button class="theme-toggle" onclick="toggleDarkMode()">ğŸŒ™</button>
    <div class="container">
        <h1>Ø¯Ø³ØªÛŒØ§Ø± Ú¯Ù„Ø®Ø§Ù†Ù‡ Ù‡ÙˆØ´Ù…Ù†Ø¯</h1>
        <div class="dashboard">
            <h3>ÙˆØ¶Ø¹ÛŒØª Ú¯Ù„Ø®Ø§Ù†Ù‡</h3>
            <p id="dashboard-temp">Ø¯Ù…Ø§: 25Â°C</p>
            <p id="dashboard-humidity">Ø±Ø·ÙˆØ¨Øª: 60%</p>
            <p id="dashboard-irrigation">Ø¢Ø¨ÛŒØ§Ø±ÛŒ: Ø®Ø§Ù…ÙˆØ´</p>
            <p id="dashboard-crop">Ù…Ø­ØµÙˆÙ„ ÙØ¹Ø§Ù„: Ø®ÛŒØ§Ø±</p>
        </div>
        <div class="tab">
            <button class="tablinks active" onclick="openTab(event, 'environment')">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2v20m10-10H2"/>
                </svg>
                Ù…Ø­ÛŒØ·
            </button>
            <button class="tablinks" onclick="openTab(event, 'irrigation')">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 12h16"/>
                </svg>
                Ø¢Ø¨ÛŒØ§Ø±ÛŒ
            </button>
            <button class="tablinks" onclick="openTab(event, 'crop')">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 20h18M12 4v16"/>
                </svg>
                Ú©Ø´Øª
            </button>
            <button class="tablinks" onclick="openTab(event, 'pests')">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 8a4 4 0 014 4 4 4 0 01-4 4 4 4 0 01-4-4 4 4 0 014-4zm0 0v4m-4 0h8"/>
                </svg>
                Ø¢ÙØ§Øª
            </button>
            <button class="tablinks" onclick="openTab(event, 'fertilizer')">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 4v16m-4 0h8"/>
                </svg>
                Ú©ÙˆØ¯Ø¯Ù‡ÛŒ
            </button>
            <button class="tablinks" onclick="openTab(event, 'reports')">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 17v-6m6 6v-9m-6 9H5a2 2 0 01-2-2V5a2 2 0 012-2h14a2 2 0 012 2v10a2 2 0 01-2 2h-4"/>
                </svg>
                Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§
            </button>
        </div>
        <!-- Ù…Ø­ÛŒØ· -->
        <div id="environment" class="tabcontent" style="display: block;">
            <div class="form-group">
                <label for="target-temp">Ø¯Ù…Ø§ÛŒ Ù‡Ø¯Ù (Â°C):</label>
                <span class="tooltip">Ø¯Ù…Ø§ÛŒ Ø§ÛŒØ¯Ù‡â€ŒØ¢Ù„ Ø¨Ø±Ø§ÛŒ Ú¯ÛŒØ§Ù‡ (10-40Â°C)</span>
                <input type="number" id="target-temp" value="25" min="10" max="40" required oninput="validateEnvironment()">
                <div class="error" id="temp-error">Ø¯Ù…Ø§ Ø¨Ø§ÛŒØ¯ Ø¨ÛŒÙ† 10 ØªØ§ 40 Ø¯Ø±Ø¬Ù‡ Ø¨Ø§Ø´Ø¯.</div>
            </div>
            <div class="form-group">
                <label for="target-humidity">Ø±Ø·ÙˆØ¨Øª Ù‡Ø¯Ù (%):</label>
                <span class="tooltip">Ø±Ø·ÙˆØ¨Øª Ø§ÛŒØ¯Ù‡â€ŒØ¢Ù„ (20-90%)</span>
                <input type="number" id="target-humidity" value="60" min="20" max="90" required oninput="validateEnvironment()">
                <div class="error" id="humidity-error">Ø±Ø·ÙˆØ¨Øª Ø¨Ø§ÛŒØ¯ Ø¨ÛŒÙ† 20 ØªØ§ 90 Ø¯Ø±ØµØ¯ Ø¨Ø§Ø´Ø¯.</div>
            </div>
            <div class="form-group">
                <label for="target-light">Ø³Ø·Ø­ Ù†ÙˆØ±:</label>
                <span class="tooltip">Ù†ÙˆØ± Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø² Ú¯ÛŒØ§Ù‡</span>
                <select id="target-light">
                    <option value="Ú©Ù…">Ú©Ù…</option>
                    <option value="Ù…ØªÙˆØ³Ø·" selected>Ù…ØªÙˆØ³Ø·</option>
                    <option value="Ø²ÛŒØ§Ø¯">Ø²ÛŒØ§Ø¯</option>
                </select>
            </div>
            <button class="submit-btn" id="env-submit" onclick="setEnvironment()">ØªÙ†Ø¸ÛŒÙ… Ù…Ø­ÛŒØ·</button>
        </div>
        <!-- Ø¢Ø¨ÛŒØ§Ø±ÛŒ -->
        <div id="irrigation" class="tabcontent">
            <div class="form-group">
                <label for="irrigation-schedule">Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ Ø¢Ø¨ÛŒØ§Ø±ÛŒ:</label>
                <span class="tooltip">Ø¯ÙˆØ±Ù‡ Ø¢Ø¨ÛŒØ§Ø±ÛŒ Ú¯ÛŒØ§Ù‡</span>
                <select id="irrigation-schedule" required oninput="validateIrrigation()">
                    <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</option>
                    <option value="Ø±ÙˆØ²Ø§Ù†Ù‡">Ø±ÙˆØ²Ø§Ù†Ù‡</option>
                    <option value="Ù‡ÙØªÚ¯ÛŒ">Ù‡ÙØªÚ¯ÛŒ</option>
                </select>
                <div class="error" id="schedule-error">Ù„Ø·ÙØ§Ù‹ Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.</div>
            </div>
            <div class="form-group">
                <label for="irrigation-duration">Ù…Ø¯Øªâ€ŒØ²Ù…Ø§Ù† (Ø¯Ù‚ÛŒÙ‚Ù‡):</label>
                <span class="tooltip">Ù…Ø¯Øª Ù‡Ø± Ø¢Ø¨ÛŒØ§Ø±ÛŒ (1-60 Ø¯Ù‚ÛŒÙ‚Ù‡)</span>
                <input type="number" id="irrigation-duration" value="10" min="1" max="60">
            </div>
            <button class="submit-btn" id="irr-submit" onclick="setIrrigation()">ØªÙ†Ø¸ÛŒÙ… Ø¢Ø¨ÛŒØ§Ø±ÛŒ</button>
        </div>
        <!-- Ú©Ø´Øª -->
        <div id="crop" class="tabcontent">
            <div class="form-group">
                <label for="crop-type">Ù…Ø­ØµÙˆÙ„:</label>
                <span class="tooltip">Ù…Ø­ØµÙˆÙ„ÛŒ Ú©Ù‡ Ú©Ø´Øª Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯</span>
                <select id="crop-type" required oninput="validateCrop()">
                    <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</option>
                    <option value="Ø®ÛŒØ§Ø±">Ø®ÛŒØ§Ø±</option>
                    <option value="Ú¯ÙˆØ¬Ù‡">Ú¯ÙˆØ¬Ù‡</option>
                </select>
                <div class="error" id="crop-error">Ù„Ø·ÙØ§Ù‹ Ù…Ø­ØµÙˆÙ„ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.</div>
            </div>
            <div class="form-group">
                <label for="crop-date">ØªØ§Ø±ÛŒØ® Ú©Ø§Ø´Øª:</label>
                <span class="tooltip">ØªØ§Ø±ÛŒØ® Ø´Ø±ÙˆØ¹ Ú©Ø´Øª</span>
                <input type="date" id="crop-date" value="">
            </div>
            <button class="submit-btn" id="crop-submit" onclick="setCrop()">Ø«Ø¨Øª Ú©Ø´Øª</button>
        </div>
        <!-- Ø¢ÙØ§Øª -->
        <div id="pests" class="tabcontent">
            <div class="form-group">
                <label for="pest-image">ØªØµÙˆÛŒØ± Ø¢ÙØª (Ø§Ø®ØªÛŒØ§Ø±ÛŒ):</label>
                <span class="tooltip">Ø¹Ú©Ø³ Ø¨Ø±Ú¯ ÛŒØ§ Ù…ÛŒÙˆÙ‡ Ø¢Ø³ÛŒØ¨â€ŒØ¯ÛŒØ¯Ù‡</span>
                <input type="file" id="pest-image" accept="image/*">
            </div>
            <div class="form-group">
                <label for="pest-type">Ù†ÙˆØ¹ Ø¢ÙØª:</label>
                <span class="tooltip">Ø¢ÙØª Ù…Ø´Ø§Ù‡Ø¯Ù‡â€ŒØ´Ø¯Ù‡</span>
                <select id="pest-type" required oninput="validatePest()">
                    <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</option>
                    <option value="Ø³ÙÛŒØ¯Ø¨Ø§Ù„Ú©">Ø³ÙÛŒØ¯Ø¨Ø§Ù„Ú©</option>
                    <option value="Ú©Ù†Ù‡">Ú©Ù†Ù‡</option>
                </select>
                <div class="error" id="pest-error">Ù„Ø·ÙØ§Ù‹ Ù†ÙˆØ¹ Ø¢ÙØª ÛŒØ§ ØªØµÙˆÛŒØ± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.</div>
            </div>
            <div class="form-group">
                <label for="pest-date">ØªØ§Ø±ÛŒØ® Ø³Ù…â€ŒÙ¾Ø§Ø´ÛŒ:</label>
                <span class="tooltip">ØªØ§Ø±ÛŒØ® Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø³Ù…</span>
                <input type="date" id="pest-date">
            </div>
            <button class="submit-btn" id="pest-submit" onclick="setPest()">Ø«Ø¨Øª Ø¢ÙØª</button>
        </div>
        <!-- Ú©ÙˆØ¯Ø¯Ù‡ÛŒ -->
        <div id="fertilizer" class="tabcontent">
            <div class="form-group">
                <label for="fertilizer-type">Ù†ÙˆØ¹ Ú©ÙˆØ¯:</label>
                <span class="tooltip">Ú©ÙˆØ¯ Ù…ÙˆØ±Ø¯ Ø§Ø³ØªÙØ§Ø¯Ù‡</span>
                <select id="fertilizer-type" required oninput="validateFertilizer()">
                    <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</option>
                    <option value="Ù†ÛŒØªØ±ÙˆÚ˜Ù†">Ù†ÛŒØªØ±ÙˆÚ˜Ù†</option>
                    <option value="Ù¾ØªØ§Ø³ÛŒÙ…">Ù¾ØªØ§Ø³ÛŒÙ…</option>
                </select>
                <div class="error" id="fertilizer-error">Ù„Ø·ÙØ§Ù‹ Ù†ÙˆØ¹ Ú©ÙˆØ¯ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.</div>
            </div>
            <div class="form-group">
                <label for="fertilizer-amount">Ù…Ù‚Ø¯Ø§Ø± (Ú¯Ø±Ù…):</label>
                <span class="tooltip">Ù…Ù‚Ø¯Ø§Ø± Ú©ÙˆØ¯ Ø¯Ø± Ù‡Ø± Ù…ØªØ±Ù…Ø±Ø¨Ø¹</span>
                <input type="number" id="fertilizer-amount" value="10" min="1" max="100">
            </div>
            <button class="submit-btn" id="fertilizer-submit" onclick="setFertilizer()">Ø«Ø¨Øª Ú©ÙˆØ¯Ø¯Ù‡ÛŒ</button>
        </div>
        <!-- Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ -->
        <div id="reports" class="tabcontent">
            <button class="submit-btn" onclick="generateReport()">ØªÙˆÙ„ÛŒØ¯ Ú¯Ø²Ø§Ø±Ø´</button>
            <button class="submit-btn" onclick="exportData()">ØµØ§Ø¯Ø± Ú©Ø±Ø¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§</button>
            <div id="result"></div>
            <div id="chart-container"></div>
        </div>
        <div id="history">
            <h3>ØªØ§Ø±ÛŒØ®Ú†Ù‡ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§</h3>
            <select id="history-filter" onchange="displayHistory()">
                <option value="all">Ù‡Ù…Ù‡</option>
                <option value="environment">Ù…Ø­ÛŒØ·</option>
                <option value="irrigation">Ø¢Ø¨ÛŒØ§Ø±ÛŒ</option>
                <option value="crop">Ú©Ø´Øª</option>
                <option value="pests">Ø¢ÙØ§Øª</option>
                <option value="fertilizer">Ú©ÙˆØ¯Ø¯Ù‡ÛŒ</option>
            </select>
            <div id="history-list"></div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù†Ù…ÙˆÙ†Ù‡ Ù…Ø­Ø¯ÙˆØ¯
        const greenhouseData = {
            environment: { temp: 25, humidity: 60, light: 'Ù…ØªÙˆØ³Ø·' },
            irrigation: { schedule: 'Ø®Ø§Ù…ÙˆØ´', duration: 10 },
            crops: [
                { type: 'Ø®ÛŒØ§Ø±', date: '1404/02/01', status: 'Ø¬ÙˆØ§Ù†Ù‡â€ŒØ²Ù†ÛŒ' },
                { type: 'Ú¯ÙˆØ¬Ù‡', date: '1404/01/15', status: 'Ú¯Ù„â€ŒØ¯Ù‡ÛŒ' }
            ],
            pests: [{ type: 'Ø³ÙÛŒØ¯Ø¨Ø§Ù„Ú©', date: '1404/02/10', treatment: 'Ù…Ø§Ù„Ø§ØªÛŒÙˆÙ†' }],
            fertilizers: [{ type: 'Ù†ÛŒØªØ±ÙˆÚ˜Ù†', amount: 10, date: '1404/02/05' }],
            history: [
                { type: 'Ù…Ø­ÛŒØ·', details: 'Ø¯Ù…Ø§: 25Â°C, Ø±Ø·ÙˆØ¨Øª: 60%, Ù†ÙˆØ±: Ù…ØªÙˆØ³Ø·', date: '1404/02/01' },
                { type: 'Ø¢Ø¨ÛŒØ§Ø±ÛŒ', details: 'Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ: Ø±ÙˆØ²Ø§Ù†Ù‡, Ù…Ø¯Øª: 10 Ø¯Ù‚ÛŒÙ‚Ù‡', date: '1404/02/01' },
                { type: 'Ú©Ø´Øª', details: 'Ù…Ø­ØµÙˆÙ„: Ø®ÛŒØ§Ø±, ØªØ§Ø±ÛŒØ® Ú©Ø§Ø´Øª: 1404/02/01', date: '1404/02/01' },
                { type: 'Ø¢ÙØ§Øª', details: 'Ø¢ÙØª: Ø³ÙÛŒØ¯Ø¨Ø§Ù„Ú©, Ø³Ù…: Ù…Ø§Ù„Ø§ØªÛŒÙˆÙ†', date: '1404/02/10' },
                { type: 'Ú©ÙˆØ¯Ø¯Ù‡ÛŒ', details: 'Ú©ÙˆØ¯: Ù†ÛŒØªØ±ÙˆÚ˜Ù†, Ù…Ù‚Ø¯Ø§Ø±: 10 Ú¯Ø±Ù…', date: '1404/02/05' }
            ]
        };

        // ØªØºÛŒÛŒØ± ØªÙ…
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
        }

        // Ù…Ø¯ÛŒØ±ÛŒØª ØªØ¨â€ŒÙ‡Ø§
        function openTab(evt, tabName) {
            document.querySelectorAll('.tabcontent').forEach(el => el.style.display = 'none');
            document.querySelectorAll('.tablinks').forEach(el => el.classList.remove('active'));
            document.getElementById(tabName).style.display = 'block';
            evt.currentTarget.classList.add('active');
        }

        // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ÙØ±Ù… Ù…Ø­ÛŒØ·
        function validateEnvironment() {
            const temp = document.getElementById('target-temp').value;
            const humidity = document.getElementById('target-humidity').value;
            const tempError = document.getElementById('temp-error');
            const humidityError = document.getElementById('humidity-error');
            const submitBtn = document.getElementById('env-submit');
            let isValid = true;

            if (!temp || temp < 10 || temp > 40) {
                tempError.style.display = 'block';
                isValid = false;
            } else {
                tempError.style.display = 'none';
            }
            if (!humidity || humidity < 20 || humidity > 90) {
                humidityError.style.display = 'block';
                isValid = false;
            } else {
                humidityError.style.display = 'none';
            }
            submitBtn.classList.toggle('enabled', isValid);
        }

        // ØªÙ†Ø¸ÛŒÙ… Ù…Ø­ÛŒØ·
        function setEnvironment() {
            if (!document.getElementById('env-submit').classList.contains('enabled')) return;
            const temp = parseFloat(document.getElementById('target-temp').value);
            const humidity = parseFloat(document.getElementById('target-humidity').value);
            const light = document.getElementById('target-light').value;
            greenhouseData.environment = { temp, humidity, light };
            greenhouseData.history.push({
                type: 'Ù…Ø­ÛŒØ·',
                details: `Ø¯Ù…Ø§: ${temp}Â°C, Ø±Ø·ÙˆØ¨Øª: ${humidity}%, Ù†ÙˆØ±: ${light}`,
                date: new Date().toLocaleDateString('fa-IR')
            });
            saveData();
            updateDashboard();
            document.getElementById('result').innerHTML = '<p style="color: #2E7D32;">Ù…Ø­ÛŒØ· ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯.</p>';
            if (temp > 30 || humidity < 50) {
                document.getElementById('result').innerHTML += '<p style="color: #FF7043;">Ù‡Ø´Ø¯Ø§Ø±: Ø´Ø±Ø§ÛŒØ· Ù…Ø­ÛŒØ·ÛŒ ØºÛŒØ±Ø¹Ø§Ø¯ÛŒ Ø§Ø³Øª!</p>';
            }
        }

        // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ÙØ±Ù… Ø¢Ø¨ÛŒØ§Ø±ÛŒ
        function validateIrrigation() {
            const schedule = document.getElementById('irrigation-schedule').value;
            const scheduleError = document.getElementById('schedule-error');
            const submitBtn = document.getElementById('irr-submit');
            if (!schedule) {
                scheduleError.style.display = 'block';
                submitBtn.classList.remove('enabled');
            } else {
                scheduleError.style.display = 'none';
                submitBtn.classList.add('enabled');
            }
        }

        // ØªÙ†Ø¸ÛŒÙ… Ø¢Ø¨ÛŒØ§Ø±ÛŒ
        function setIrrigation() {
            if (!document.getElementById('irr-submit').classList.contains('enabled')) return;
            const schedule = document.getElementById('irrigation-schedule').value;
            const duration = parseInt(document.getElementById('irrigation-duration').value) || 10;
            greenhouseData.irrigation = { schedule, duration };
            greenhouseData.history.push({
                type: 'Ø¢Ø¨ÛŒØ§Ø±ÛŒ',
                details: `Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ: ${schedule}, Ù…Ø¯Øª: ${duration} Ø¯Ù‚ÛŒÙ‚Ù‡`,
                date: new Date().toLocaleDateString('fa-IR')
            });
            saveData();
            updateDashboard();
            document.getElementById('result').innerHTML = '<p style="color: #2E7D32;">Ø¢Ø¨ÛŒØ§Ø±ÛŒ ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯.</p>';
        }

        // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ÙØ±Ù… Ú©Ø´Øª
        function validateCrop() {
            const crop = document.getElementById('crop-type').value;
            const cropError = document.getElementById('crop-error');
            const submitBtn = document.getElementById('crop-submit');
            if (!crop) {
                cropError.style.display = 'block';
                submitBtn.classList.remove('enabled');
            } else {
                cropError.style.display = 'none';
                submitBtn.classList.add('enabled');
            }
        }

        // Ø«Ø¨Øª Ú©Ø´Øª
        function setCrop() {
            if (!document.getElementById('crop-submit').classList.contains('enabled')) return;
            const type = document.getElementById('crop-type').value;
            const date = document.getElementById('crop-date').value || new Date().toLocaleDateString('fa-IR');
            greenhouseData.crops.push({ type, date, status: 'Ø¬ÙˆØ§Ù†Ù‡â€ŒØ²Ù†ÛŒ' });
            greenhouseData.history.push({
                type: 'Ú©Ø´Øª',
                details: `Ù…Ø­ØµÙˆÙ„: ${type}, ØªØ§Ø±ÛŒØ® Ú©Ø§Ø´Øª: ${date}`,
                date: new Date().toLocaleDateString('fa-IR')
            });
            saveData();
            updateDashboard();
            document.getElementById('result').innerHTML = '<p style="color: #2E7D32;">Ú©Ø´Øª Ø«Ø¨Øª Ø´Ø¯.</p>';
        }

        // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ÙØ±Ù… Ø¢ÙØ§Øª
        function validatePest() {
            const pest = document.getElementById('pest-type').value;
            const image = document.getElementById('pest-image').files.length;
            const pestError = document.getElementById('pest-error');
            const submitBtn = document.getElementById('pest-submit');
            if (!pest && !image) {
                pestError.style.display = 'block';
                submitBtn.classList.remove('enabled');
            } else {
                pestError.style.display = 'none';
                submitBtn.classList.add('enabled');
            }
        }

        // Ø«Ø¨Øª Ø¢ÙØª
        function setPest() {
            if (!document.getElementById('pest-submit').classList.contains('enabled')) return;
            const image = document.getElementById('pest-image').files.length ? 'ØªØµÙˆÛŒØ± Ø¢Ù¾Ù„ÙˆØ¯ Ø´Ø¯' : 'Ø¨Ø¯ÙˆÙ† ØªØµÙˆÛŒØ±';
            const type = document.getElementById('pest-type').value || 'Ù†Ø§Ù…Ø´Ø®Øµ';
            const date = document.getElementById('pest-date').value || new Date().toLocaleDateString('fa-IR');
            // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ ØªØ´Ø®ÛŒØµ Ø¢ÙØª (Ø¨Ø±Ø§ÛŒ Ø¢ÛŒÙ†Ø¯Ù‡: TensorFlow.js)
            const treatment = type === 'Ø³ÙÛŒØ¯Ø¨Ø§Ù„Ú©' ? 'Ù…Ø§Ù„Ø§ØªÛŒÙˆÙ†' : 'Ù‚Ø§Ø±Ú†â€ŒÚ©Ø´';
            greenhouseData.pests.push({ type, date, treatment, image });
            greenhouseData.history.push({
                type: 'Ø¢ÙØ§Øª',
                details: `Ø¢ÙØª: ${type}, Ø³Ù…: ${treatment}, ØªØµÙˆÛŒØ±: ${image}`,
                date
            });
            saveData();
            document.getElementById('result').innerHTML = `<p style="color: #2E7D32;">Ø¢ÙØª Ø«Ø¨Øª Ø´Ø¯. Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯: ${treatment}</p>`;
            if (new Date(date) > new Date(new Date().setDate(new Date().getDate() - 21))) {
                document.getElementById('result').innerHTML += '<p style="color: #FF7043;">Ù‡Ø´Ø¯Ø§Ø±: ÙØ§ØµÙ„Ù‡ Ø³Ù…â€ŒÙ¾Ø§Ø´ÛŒ ØªØ§ Ø¨Ø±Ø¯Ø§Ø´Øª Ú©Ù…ØªØ± Ø§Ø² 21 Ø±ÙˆØ² Ø§Ø³Øª!</p>';
            }
        }

        // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ÙØ±Ù… Ú©ÙˆØ¯Ø¯Ù‡ÛŒ
        function validateFertilizer() {
            const fertilizer = document.getElementById('fertilizer-type').value;
            const fertilizerError = document.getElementById('fertilizer-error');
            const submitBtn = document.getElementById('fertilizer-submit');
            if (!fertilizer) {
                fertilizerError.style.display = 'block';
                submitBtn.classList.remove('enabled');
            } else {
                fertilizerError.style.display = 'none';
                submitBtn.classList.add('enabled');
            }
        }

        // Ø«Ø¨Øª Ú©ÙˆØ¯Ø¯Ù‡ÛŒ
        function setFertilizer() {
            if (!document.getElementById('fertilizer-submit').classList.contains('enabled')) return;
            const type = document.getElementById('fertilizer-type').value;
            const amount = parseInt(document.getElementById('fertilizer-amount').value) || 10;
            const date = new Date().toLocaleDateString('fa-IR');
            greenhouseData.fertilizers.push({ type, amount, date });
            greenhouseData.history.push({
                type: 'Ú©ÙˆØ¯Ø¯Ù‡ÛŒ',
                details: `Ú©ÙˆØ¯: ${type}, Ù…Ù‚Ø¯Ø§Ø±: ${amount} Ú¯Ø±Ù…`,
                date
            });
            saveData();
            document.getElementById('result').innerHTML = '<p style="color: #2E7D32;">Ú©ÙˆØ¯Ø¯Ù‡ÛŒ Ø«Ø¨Øª Ø´Ø¯.</p>';
            if (amount > 50) {
                document.getElementById('result').innerHTML += '<p style="color: #FF7043;">Ù‡Ø´Ø¯Ø§Ø±: Ù…Ù‚Ø¯Ø§Ø± Ú©ÙˆØ¯ Ø²ÛŒØ§Ø¯ Ø§Ø³Øª!</p>';
            }
        }

        // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
        function saveData() {
            localStorage.setItem('greenhouseData', JSON.stringify(greenhouseData));
        }

        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯
        function updateDashboard() {
            document.getElementById('dashboard-temp').innerText = `Ø¯Ù…Ø§: ${greenhouseData.environment.temp}Â°C`;
            document.getElementById('dashboard-humidity').innerText = `Ø±Ø·ÙˆØ¨Øª: ${greenhouseData.environment.humidity}%`;
            document.getElementById('dashboard-irrigation').innerText = `Ø¢Ø¨ÛŒØ§Ø±ÛŒ: ${greenhouseData.irrigation.schedule}`;
            document.getElementById('dashboard-crop').innerText = `Ù…Ø­ØµÙˆÙ„ ÙØ¹Ø§Ù„: ${greenhouseData.crops[greenhouseData.crops.length - 1]?.type || 'Ù‡ÛŒÚ†'}`;
        }

        // Ù†Ù…Ø§ÛŒØ´ ØªØ§Ø±ÛŒØ®Ú†Ù‡
        function displayHistory() {
            const filter = document.getElementById('history-filter').value;
            const historyList = document.getElementById('history-list');
            historyList.innerHTML = '';
            greenhouseData.history
                .filter(item => filter === 'all' || item.type === filter)
                .forEach(item => {
                    historyList.innerHTML += `
                        <div class="history-item">
                            <p><strong>Ù†ÙˆØ¹:</strong> ${item.type}</p>
                            <p><strong>Ø¬Ø²Ø¦ÛŒØ§Øª:</strong> ${item.details}</p>
                            <p><strong>ØªØ§Ø±ÛŒØ®:</strong> ${item.date}</p>
                        </div>
                    `;
                });
        }

        // ØªÙˆÙ„ÛŒØ¯ Ú¯Ø²Ø§Ø±Ø´
        function generateReport() {
            const result = document.getElementById('result');
            const activeCrop = greenhouseData.crops[greenhouseData.crops.length - 1]?.type || 'Ù‡ÛŒÚ†';
            const waterUsage = greenhouseData.irrigation.schedule === 'Ø±ÙˆØ²Ø§Ù†Ù‡' ? 100 : 50; // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ
            const production = activeCrop === 'Ø®ÛŒØ§Ø±' ? 5 : 4; // ØªÙ†/Ù‡Ú©ØªØ§Ø±
            result.innerHTML = `
                <h3>Ú¯Ø²Ø§Ø±Ø´ Ú¯Ù„Ø®Ø§Ù†Ù‡</h3>
                <p><strong>Ù…Ø­ÛŒØ·:</strong> Ø¯Ù…Ø§: ${greenhouseData.environment.temp}Â°C, Ø±Ø·ÙˆØ¨Øª: ${greenhouseData.environment.humidity}%, Ù†ÙˆØ±: ${greenhouseData.environment.light}</p>
                <p><strong>Ø¢Ø¨ÛŒØ§Ø±ÛŒ:</strong> ${greenhouseData.irrigation.schedule}, ${greenhouseData.irrigation.duration} Ø¯Ù‚ÛŒÙ‚Ù‡, Ù…ØµØ±Ù: ${waterUsage} Ù„ÛŒØªØ±/Ø±ÙˆØ²</p>
                <p><strong>Ú©Ø´Øª:</strong> Ù…Ø­ØµÙˆÙ„: ${activeCrop}, ÙˆØ¶Ø¹ÛŒØª: ${greenhouseData.crops[greenhouseData.crops.length - 1]?.status || 'Ù†Ø§Ù…Ø´Ø®Øµ'}</p>
                <p><strong>Ø¢ÙØ§Øª:</strong> ${greenhouseData.pests.length ? greenhouseData.pests[greenhouseData.pests.length - 1].type : 'Ù‡ÛŒÚ†'}</p>
                <p><strong>Ú©ÙˆØ¯Ø¯Ù‡ÛŒ:</strong> ${greenhouseData.fertilizers.length ? greenhouseData.fertilizers[greenhouseData.fertilizers.length - 1].type : 'Ù‡ÛŒÚ†'}</p>
                <p><strong>Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ ØªÙˆÙ„ÛŒØ¯:</strong> ${production} ØªÙ†/Ù‡Ú©ØªØ§Ø± Ø¯Ø± 3 Ù…Ø§Ù‡</p>
            `;
            drawReportChart();
        }

        // Ù†Ù…ÙˆØ¯Ø§Ø± Ú¯Ø²Ø§Ø±Ø´
        function drawReportChart() {
            const chartContainer = document.getElementById('chart-container');
            chartContainer.innerHTML = '<canvas id="reportChart"></canvas>';
            const ctx = document.getElementById('reportChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Ø¯Ù…Ø§ (Â°C)', 'Ø±Ø·ÙˆØ¨Øª (%)', 'Ù…ØµØ±Ù Ø¢Ø¨ (Ù„ÛŒØªØ±)'],
                    datasets: [{
                        label: 'ÙˆØ¶Ø¹ÛŒØª Ú¯Ù„Ø®Ø§Ù†Ù‡',
                        data: [
                            greenhouseData.environment.temp,
                            greenhouseData.environment.humidity,
                            greenhouseData.irrigation.schedule === 'Ø±ÙˆØ²Ø§Ù†Ù‡' ? 100 : 50
                        ],
                        backgroundColor: ['#2E7D32', '#4FC3F7', '#FF7043'],
                        borderColor: ['#1B5E20', '#0288D1', '#D84315'],
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: { y: { beginAtZero: true, title: { display: true, text: 'Ù…Ù‚Ø¯Ø§Ø±' } } },
                    plugins: { title: { display: true, text: 'ÙˆØ¶Ø¹ÛŒØª Ú¯Ù„Ø®Ø§Ù†Ù‡', font: { size: 18 } } }
                }
            });
        }

        // ØµØ§Ø¯Ø±Ø§Øª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
        function exportData() {
            const dataStr = JSON.stringify(greenhouseData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'greenhouse_data.json';
            link.click();
            URL.revokeObjectURL(url);
            document.getElementById('result').innerHTML = '<p style="color: #2E7D32;">Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ ØµØ§Ø¯Ø± Ø´Ø¯.</p>';
        }

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
        document.addEventListener('DOMContentLoaded', () => {
            const savedData = JSON.parse(localStorage.getItem('greenhouseData'));
            if (savedData) Object.assign(greenhouseData, savedData);
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') document.body.classList.add('dark-mode');
            updateDashboard();
            displayHistory();
            validateEnvironment();
            validateIrrigation();
            validateCrop();
            validatePest();
            validateFertilizer();
        });
    </script>
</body>
</html>