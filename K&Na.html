<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سیستم گزارش کار نویسی - اندازه‌گیری سدیم و پتاسیم</title>

    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Tahoma:wght@400;700&display=swap" rel="stylesheet">
    
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #2e7d32;
            --primary-light: #60ad5e;
            --primary-dark: #005005;
            --secondary-color: #ff8f00;
            --background-color: #f5f9f5;
            --card-color: #ffffff;
            --text-color: #263238;
            --text-light: #607d8b;
            --border-radius: 12px;
            --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Vazirmatn', sans-serif;
        }

        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 0;
            margin: 0;
            direction: rtl;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 20px 0;
            text-align: center;
            border-bottom: 5px solid var(--secondary-color);
            margin-bottom: 30px;
            box-shadow: var(--box-shadow);
        }

        header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .logo i {
            font-size: 32px;
            color: var(--secondary-color);
        }

        .card {
            background-color: var(--card-color);
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
        }

        .card:hover {
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.12);
        }

        .card-title {
            color: var(--primary-color);
            font-size: 22px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-light);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-title i {
            color: var(--secondary-color);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 15px;
        }

        th, td {
            padding: 15px;
            text-align: center;
            border: 1px solid #e0e0e0;
        }

        th {
            background-color: var(--primary-color);
            color: white;
            font-weight: 500;
        }

        tr:nth-child(even) {
            background-color: #f5f5f5;
        }

        tr:hover {
            background-color: #e8f5e9;
        }

        input[type="number"] {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 15px;
            transition: var(--transition);
            text-align: center;
        }

        input[type="number"]:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.2);
            outline: none;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--primary-dark);
        }

        .btn {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 14px 28px;
            font-size: 16px;
            font-weight: 500;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            width: 100%;
            max-width: 250px;
            margin: 20px auto;
        }

        .btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .btn i {
            margin-left: 8px;
        }

        .result-container {
            background-color: #e8f5e9;
            padding: 20px;
            border-radius: var(--border-radius);
            margin-top: 20px;
            text-align: center;
        }

        .result-title {
            color: var(--primary-dark);
            font-size: 18px;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .result-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-color);
            margin: 10px 0;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin: 40px 0;
        }

        .report-section {
            margin-top: 40px;
        }

        .report-section h3 {
            color: var(--primary-dark);
            font-size: 20px;
            margin: 25px 0 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e0e0e0;
        }

        .report-section h4 {
            color: var(--primary-color);
            font-size: 18px;
            margin: 20px 0 10px;
        }

        .report-section p {
            margin-bottom: 15px;
            text-align: justify;
        }

        .report-section ul, .report-section ol {
            margin: 15px 0;
            padding-right: 20px;
        }

        .report-section li {
            margin-bottom: 8px;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #e0e0e0;
        }

        .tab {
            padding: 12px 20px;
            cursor: pointer;
            font-weight: 500;
            color: var(--text-light);
            transition: var(--transition);
            border-bottom: 3px solid transparent;
        }

        .tab.active {
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
        }

        .tab:hover:not(.active) {
            color: var(--primary-dark);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .export-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .export-btn {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .export-btn:hover {
            background-color: #e65100;
            transform: translateY(-2px);
        }

        .sensor-status {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .sensor-card {
            background: white;
            padding: 15px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            width: 22%;
            min-width: 200px;
            text-align: center;
            margin: 10px;
        }

        .sensor-icon {
            font-size: 28px;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .sensor-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-dark);
        }

        .sensor-label {
            font-size: 14px;
            color: var(--text-light);
        }

        @media (max-width: 768px) {
            .sensor-card {
                width: 45%;
            }
            
            .card {
                padding: 15px;
            }
            
            th, td {
                padding: 10px;
            }
        }

        @media (max-width: 480px) {
            .sensor-card {
                width: 100%;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                border-bottom: none;
                border-right: 3px solid transparent;
            }
            
            .tab.active {
                border-bottom: none;
                border-right: 3px solid var(--primary-color);
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">
                <i class="fas fa-seedling"></i>
                <h1>سیستم هوشمند آنالیز خاک کشاورزی</h1>
            </div>
            <p>اندازه‌گیری دقیق غلظت سدیم و پتاسیم در خاک با فناوری پیشرفته</p>
        </div>
    </header>

    <div class="container">
        <div class="tabs">
            <div class="tab active" onclick="openTab('data-entry')">ورود داده‌ها</div>
            <div class="tab" onclick="openTab('results')">نتایج آنالیز</div>
            <div class="tab" onclick="openTab('report')">گزارش کار</div>
            <div class="tab" onclick="openTab('dashboard')">داشبورد</div>
        </div>

        <div id="data-entry" class="tab-content active">
            <div class="card">
                <h2 class="card-title"><i class="fas fa-table"></i> داده‌های کالیبراسیون</h2>
                
                <div class="sensor-status">
                    <div class="sensor-card">
                        <div class="sensor-icon"><i class="fas fa-flask"></i></div>
                        <div class="sensor-value" id="na-samples">0</div>
                        <div class="sensor-label">نمونه‌های سدیم</div>
                    </div>
                    <div class="sensor-card">
                        <div class="sensor-icon"><i class="fas fa-flask"></i></div>
                        <div class="sensor-value" id="k-samples">0</div>
                        <div class="sensor-label">نمونه‌های پتاسیم</div>
                    </div>
                    <div class="sensor-card">
                        <div class="sensor-icon"><i class="fas fa-calendar-alt"></i></div>
                        <div class="sensor-value" id="current-date">--/--/----</div>
                        <div class="sensor-label">تاریخ آزمایش</div>
                    </div>
                    <div class="sensor-card">
                        <div class="sensor-icon"><i class="fas fa-user"></i></div>
                        <div class="sensor-value" id="operator">اپراتور</div>
                        <div class="sensor-label">مسئول آزمایش</div>
                    </div>
                </div>

                <div class="row">
                    <div class="col">
                        <h3 class="card-title"><i class="fas fa-atom"></i> کالیبراسیون سدیم (Na)</h3>
                        <table id="sodiumTable">
                            <thead>
                                <tr>
                                    <th>غلظت استاندارد (ppm)</th>
                                    <th>عدد دستگاه</th>
                                    <th>واحد</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td><input type="number" class="na-std" onchange="updateSampleCount()"></td><td><input type="number" class="na-read"></td><td>ppm</td></tr>
                                <tr><td><input type="number" class="na-std" onchange="updateSampleCount()"></td><td><input type="number" class="na-read"></td><td>ppm</td></tr>
                                <tr><td><input type="number" class="na-std" onchange="updateSampleCount()"></td><td><input type="number" class="na-read"></td><td>ppm</td></tr>
                                <tr><td><input type="number" class="na-std" onchange="updateSampleCount()"></td><td><input type="number" class="na-read"></td><td>ppm</td></tr>
                                <tr><td><input type="number" class="na-std" onchange="updateSampleCount()"></td><td><input type="number" class="na-read"></td><td>ppm</td></tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="col">
                        <h3 class="card-title"><i class="fas fa-atom"></i> کالیبراسیون پتاسیم (K)</h3>
                        <table id="potassiumTable">
                            <thead>
                                <tr>
                                    <th>غلظت استاندارد (ppm)</th>
                                    <th>عدد دستگاه</th>
                                    <th>واحد</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td><input type="number" class="k-std" onchange="updateSampleCount()"></td><td><input type="number" class="k-read"></td><td>ppm</td></tr>
                                <tr><td><input type="number" class="k-std" onchange="updateSampleCount()"></td><td><input type="number" class="k-read"></td><td>ppm</td></tr>
                                <tr><td><input type="number" class="k-std" onchange="updateSampleCount()"></td><td><input type="number" class="k-read"></td><td>ppm</td></tr>
                                <tr><td><input type="number" class="k-std" onchange="updateSampleCount()"></td><td><input type="number" class="k-read"></td><td>ppm</td></tr>
                                <tr><td><input type="number" class="k-std" onchange="updateSampleCount()"></td><td><input type="number" class="k-read"></td><td>ppm</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2 class="card-title"><i class="fas fa-vial"></i> داده‌های نمونه خاک</h2>
                
                <div class="input-group">
                    <label for="operator-name"><i class="fas fa-user"></i> نام اپراتور:</label>
                    <input type="text" id="operator-name" placeholder="نام مسئول آزمایش را وارد کنید">
                </div>
                
                <div class="input-group">
                    <label for="sample-id"><i class="fas fa-barcode"></i> شناسه نمونه:</label>
                    <input type="text" id="sample-id" placeholder="شناسه منحصر به فرد نمونه">
                </div>
                
                <div class="row">
                    <div class="col">
                        <div class="input-group">
                            <label for="naUnknown"><i class="fas fa-atom"></i> عدد دستگاه برای سدیم:</label>
                            <input type="number" id="naUnknown" placeholder="عدد دستگاه را وارد کنید">
                        </div>
                        
                        <div class="input-group">
                            <label for="naDilution"><i class="fas fa-water"></i> ضریب رقت سدیم:</label>
                            <input type="number" id="naDilution" placeholder="ضریب رقت را وارد کنید" value="1">
                        </div>
                    </div>
                    
                    <div class="col">
                        <div class="input-group">
                            <label for="kUnknown"><i class="fas fa-atom"></i> عدد دستگاه برای پتاسیم:</label>
                            <input type="number" id="kUnknown" placeholder="عدد دستگاه را وارد کنید">
                        </div>
                        
                        <div class="input-group">
                            <label for="kDilution"><i class="fas fa-water"></i> ضریب رقت پتاسیم:</label>
                            <input type="number" id="kDilution" placeholder="ضریب رقت را وارد کنید" value="1">
                        </div>
                    </div>
                </div>
                
                <button class="btn" onclick="calculateConcentrations()">
                    <i class="fas fa-calculator"></i> محاسبه غلظت
                </button>
            </div>
        </div>

        <div id="results" class="tab-content">
            <div class="card">
                <h2 class="card-title"><i class="fas fa-chart-line"></i> نتایج آنالیز خاک</h2>
                
                <div class="result-container">
                    <div class="result-title">نتایج محاسبات</div>
                    <div id="result-values">
                        لطفاً ابتدا محاسبات را انجام دهید.
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="chartNa2D" width="800" height="400"></canvas>
                </div>
                
                <div class="chart-container">
                    <canvas id="chartK2D" width="800" height="400"></canvas>
                </div>
                
                <div class="export-buttons">
                    <button class="export-btn" onclick="exportToPDF()">
                        <i class="fas fa-file-pdf"></i> ذخیره به PDF
                    </button>
                    <button class="export-btn" onclick="exportToExcel()">
                        <i class="fas fa-file-excel"></i> ذخیره به Excel
                    </button>
                    <button class="export-btn" onclick="printReport()">
                        <i class="fas fa-print"></i> چاپ گزارش
                    </button>
                </div>
            </div>
        </div>

        <div id="report" class="tab-content">
            <div class="card report-section">
                <h2 class="card-title"><i class="fas fa-file-alt"></i> گزارش کار آزمایش</h2>
                
                <div class="report-meta">
                    <div><strong>تاریخ آزمایش:</strong> <span id="report-date">--/--/----</span></div>
                    <div><strong>مسئول آزمایش:</strong> <span id="report-operator">---</span></div>
                    <div><strong>شناسه نمونه:</strong> <span id="report-sample-id">---</span></div>
                </div>
                
                <h3>۱. نام آزمایش</h3>
                <p>
                    اندازه‌گیری غلظت سدیم (Na) و پتاسیم (K) در نمونه خاک با استفاده از روش طیف‌سنجی نشر شعله
                </p>
                
                <h3>۲. مقدمه</h3>
                <p>
                    سدیم و پتاسیم از عناصر کلیدی در خاک‌های کشاورزی هستند که نقش مهمی در تغذیه گیاهان و سلامت خاک ایفا می‌کنند. سدیم در مقادیر بالا می‌تواند باعث شوری خاک و کاهش جذب آب توسط گیاهان شود، در حالی که پتاسیم برای فرآیندهای فیزیولوژیکی گیاه مانند فتوسنتز و تنظیم آب ضروری است. این آزمایش با هدف تعیین دقیق غلظت این دو عنصر در یک نمونه خاک خاص انجام شده است تا اطلاعات لازم برای مدیریت بهینه خاک و برنامه‌ریزی کشاورزی فراهم شود. روش مورد استفاده، طیف‌سنجی نشر شعله، به دلیل دقت بالا و توانایی اندازه‌گیری غلظت‌های کم عناصر، انتخاب شده است.
                </p>
                
                <h3>۳. مواد و وسایل مورد نیاز</h3>
                <ul>
                    <li>دستگاه طیف‌سنج نشر شعله (Flame Photometer) یا طیف‌سنج ICP-OES</li>
                    <li>محلول‌های استاندارد سدیم و پتاسیم با غلظت‌های مشخص (۵، ۱۰، ۲۰، ۴۰، ۸۰ ppm)</li>
                    <li>نمونه خاک مورد آزمایش (خشک و الک‌شده)</li>
                    <li>دستگاه استخراج خاک (مانند شیکر یا سانتریفیوژ)</li>
                    <li>آب مقطر با خلوص بالا</li>
                    <li>مواد شیمیایی درجه آزمایشگاهی (مانند نیترات سدیم و کلرید پتاسیم)</li>
                    <li>پیپت‌ها و بالن‌های حجمی استاندارد</li>
                    <li>ظروف آزمایشگاهی مقاوم به حرارت (بشر، ارلن‌مایر)</li>
                    <li>فیلتر کاغذی و قیف برای جداسازی محلول استخراج‌شده</li>
                </ul>
                
                <h3>۴. نحوه انجام آزمایش</h3>
                <ol>
                    <li><strong>آماده‌سازی محلول‌های استاندارد:</strong> محلول‌های استاندارد سدیم و پتاسیم با غلظت‌های ۵، ۱۰، ۲۰، ۴۰ و ۸۰ ppm با استفاده از نیترات سدیم و کلرید پتاسیم در آب مقطر تهیه شدند.</li>
                    <li><strong>کالیبراسیون دستگاه:</strong> دستگاه طیف‌سنج نشر شعله کالیبره شد. محلول‌های استاندارد به ترتیب در دستگاه قرار گرفتند و پاسخ دستگاه (Response Value) برای هر غلظت ثبت شد.</li>
                    <li><strong>استخراج نمونه خاک:</strong> نمونه خاک خشک و الک‌شده (با مش ۲ میلی‌متر) وزن شد (۱۰ گرم) و با ۱۰۰ میلی‌لیتر آب مقطر مخلوط گردید. مخلوط به مدت ۳۰ دقیقه در شیکر قرار گرفت و سپس فیلتر شد.</li>
                    <li><strong>اندازه‌گیری نمونه:</strong> محلول استخراج‌شده از خاک در دستگاه قرار گرفت و پاسخ دستگاه برای سدیم و پتاسیم ثبت شد.</li>
                    <li><strong>محاسبات:</strong> با استفاده از داده‌های کالیبراسیون، منحنی‌های کالیبراسیون رسم شدند و غلظت‌های واقعی سدیم و پتاسیم با اعمال ضریب رقت محاسبه شدند.</li>
                </ol>
                
                <h3>۵. محاسبات</h3>
                <p id="calculations">
                    برای محاسبه غلظت‌های سدیم و پتاسیم، از معادلات رگرسیون خطی حاصل از داده‌های کالیبراسیون استفاده شد:<br>
                    - معادله کالیبراسیون سدیم: C_Na = a_Na × R + b_Na<br>
                    - معادله کالیبراسیون پتاسیم: C_K = a_K × R + b_K<br><br>
                    غلظت واقعی با اعمال ضریب رقت (D) به صورت زیر محاسبه شد:<br>
                    - غلظت واقعی سدیم: C_Na_real = (a_Na × R_unknown + b_Na) × D_Na<br>
                    - غلظت واقعی پتاسیم: C_K_real = (a_K × R_unknown + b_K) × D_K<br><br>
                    نتایج محاسبات:<br>
                    - سدیم: <span id="calc-na">-- ppm</span><br>
                    - پتاسیم: <span id="calc-k">-- ppm</span><br>
                    - ضریب تعیین (R²) سدیم: <span id="calc-r2-na">--</span><br>
                    - ضریب تعیین (R²) پتاسیم: <span id="calc-r2-k">--</span>
                </p>
                
                <h3>۶. ارزیابی و نتایج</h3>
                <p id="evaluation-results">
                    نتایج حاصل از این آزمایش نشان‌دهنده غلظت‌های سدیم و پتاسیم در نمونه خاک است. این مقادیر با استانداردهای خاک‌های کشاورزی مقایسه شدند. در صورت بالا بودن غلظت سدیم (بیش از ۱۰۰ ppm)، خاک ممکن است به شوری حساس باشد که نیاز به اقدامات اصلاحی مانند شستشوی خاک دارد. کمبود پتاسیم (کمتر از ۱۵۰ ppm) می‌تواند نشان‌دهنده نیاز به افزودن کودهای پتاسیمی باشد. نسبت سدیم به پتاسیم (Na/K) نیز ارزیابی شد تا تعادل تغذیه‌ای خاک بررسی شود.
                </p>
                
                <h3>۷. پیشنهادات</h3>
                <div id="recommendations-report">
                    <ul>
                        <li>در صورت بالا بودن غلظت سدیم، استفاده از گچ کشاورزی و شستشوی خاک توصیه می‌شود.</li>
                        <li>در صورت کمبود پتاسیم، افزودن کودهای پتاسیمی مانند سولفات پتاسیم پیشنهاد می‌شود.</li>
                        <li>انجام آزمایش‌های دوره‌ای برای پایش تغییرات غلظت عناصر در خاک.</li>
                        <li>مشاوره با متخصصان خاک‌شناسی برای تدوین برنامه کوددهی بهینه.</li>
                    </ul>
                </div>
                
                <h3>۸. منابع خطای آزمایش</h3>
                <ul>
                    <li>خطای کالیبراسیون دستگاه ناشی از عدم دقت در تهیه محلول‌های استاندارد.</li>
                    <li>آلودگی نمونه خاک یا محلول‌های استاندارد با مواد خارجی.</li>
                    <li>نوسانات دمایی یا فشار در دستگاه طیف‌سنج که می‌تواند بر پاسخ دستگاه اثر بگذارد.</li>
                    <li>خطای انسانی در وزن کردن نمونه یا خواندن مقادیر دستگاه.</li>
                    <li>عدم یکنواختی در استخراج خاک که ممکن است به نتایج نادرست منجر شود.</li>
                </ul>
                
                <h3>۹. منابع محتوایی</h3>
                <ul>
                    <li>Brady, N. C., & Weil, R. R. (2016). The Nature and Properties of Soils. Pearson Education.</li>
                    <li>Standard Methods for the Examination of Soil (2020). American Society of Agronomy.</li>
                    <li>Manual for Flame Photometry Analysis (2018). Manufacturer Documentation.</li>
                    <li>Havlin, J. L., et al. (2014). Soil Fertility and Fertilizers: An Introduction to Nutrient Management.</li>
                </ul>
                
                <h3>۱۰. ضمائم</h3>
                <ol>
                    <li>منحنی‌های کالیبراسیون سدیم و پتاسیم (موجود در تب نتایج)</li>
                    <li>داده‌های خام کالیبراسیون و نمونه‌ها</li>
                    <li>پروتکل استاندارد انجام آزمایش</li>
                </ol>
                
                <div class="export-buttons">
                    <button class="export-btn" onclick="exportToPDF()">
                        <i class="fas fa-file-pdf"></i> ذخیره گزارش PDF
                    </button>
                    <button class="export-btn" onclick="printReport()">
                        <i class="fas fa-print"></i> چاپ گزارش
                    </button>
                </div>
            </div>
        </div>

        <div id="dashboard" class="tab-content">
            <div class="card">
                <h2 class="card-title"><i class="fas fa-tachometer-alt"></i> داشبورد مدیریت خاک</h2>
                
                <div class="sensor-status">
                    <div class="sensor-card">
                        <div class="sensor-icon"><i class="fas fa-atom"></i></div>
                        <div class="sensor-value" id="dashboard-na">--</div>
                        <div class="sensor-label">غلظت سدیم (ppm)</div>
                    </div>
                    <div class="sensor-card">
                        <div class="sensor-icon"><i class="fas fa-atom"></i></div>
                        <div class="sensor-value" id="dashboard-k">--</div>
                        <div class="sensor-label">غلظت پتاسیم (ppm)</div>
                    </div>
                    <div class="sensor-card">
                        <div class="sensor-icon"><i class="fas fa-percentage"></i></div>
                        <div class="sensor-value" id="dashboard-ratio">--</div>
                        <div class="sensor-label">نسبت Na/K</div>
                    </div>
                    <div class="sensor-card">
                        <div class="sensor-icon"><i class="fas fa-check-circle"></i></div>
                        <div class="sensor-value" id="dashboard-status">--</div>
                        <div class="sensor-label">وضعیت خاک</div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="dashboard-chart" width="800" height="400"></canvas>
                </div>
                
                <h3 class="card-title"><i class="fas fa-lightbulb"></i> توصیه‌های کشاورزی هوشمند</h3>
                <div id="recommendations">
                    <p>پس از انجام آزمایش و مشاهده نتایج، توصیه‌های هوشمند در این بخش نمایش داده خواهند شد.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // تاریخ جاری
        const now = new Date();
        const persianDate = new Intl.DateTimeFormat('fa-IR', {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit'
        }).format(now);
        
        document.getElementById('current-date').textContent = persianDate;
        document.getElementById('report-date').textContent = persianDate;
        
        // تعداد نمونه‌های معتبر
        function updateSampleCount() {
            const naStdInputs = document.querySelectorAll('.na-std');
            const kStdInputs = document.querySelectorAll('.k-std');
            
            let naCount = 0;
            let kCount = 0;
            
            naStdInputs.forEach(input => {
                if (input.value && !isNaN(input.value)) naCount++;
            });
            
            kStdInputs.forEach(input => {
                if (input.value && !isNaN(input.value)) kCount++;
            });
            
            document.getElementById('na-samples').textContent = naCount;
            document.getElementById('k-samples').textContent = kCount;
        }
        
        // تغییر تب‌ها
        function openTab(tabName) {
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });
            
            const tabButtons = document.querySelectorAll('.tab');
            tabButtons.forEach(button => {
                button.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.currentTarget.classList.add('active');
        }
        
        // دریافت داده‌های جدول
        function getTableData(tableId) {
            const rows = document.querySelectorAll(`#${tableId} tbody tr`);
            const standards = [];
            const readings = [];
            
            rows.forEach(row => {
                const stdInput = row.cells[0].querySelector('input');
                const readInput = row.cells[1].querySelector('input');
                
                const std = parseFloat(stdInput.value);
                const read = parseFloat(readInput.value);
                
                if (!isNaN(std) && !isNaN(read)) {
                    standards.push(std);
                    readings.push(read);
                }
            });
            
            return { standards, readings };
        }
        
        // محاسبه رگرسیون خطی
        function linearRegression(x, y) {
            const n = x.length;
            const sumX = x.reduce((a, b) => a + b, 0);
            const sumY = y.reduce((a, b) => a + b, 0);
            const sumXY = x.reduce((acc, xi, i) => acc + xi * y[i], 0);
            const sumXX = x.reduce((acc, xi) => acc + xi * xi, 0);
            
            const a = (n * sumXY - sumX * sumY) / (n * sumXX - sumX * sumX);
            const b = (sumY - a * sumX) / n;
            
            return { a, b, rSquared: calculateRSquared(x, y, a, b) };
        }
        
        // محاسبه R-squared
        function calculateRSquared(x, y, a, b) {
            const n = x.length;
            const yMean = y.reduce((sum, val) => sum + val, 0) / n;
            
            let ssTot = 0;
            let ssRes = 0;
            
            for (let i = 0; i < n; i++) {
                const yPred = a * x[i] + b;
                ssTot += Math.pow(y[i] - yMean, 2);
                ssRes += Math.pow(y[i] - yPred, 2);
            }
            
            return 1 - (ssRes / ssTot);
        }
        
        // محاسبه غلظت‌ها
        function calculateConcentrations() {
            // دریافت اطلاعات اپراتور و نمونه
            const operatorName = document.getElementById('operator-name').value || 'نامشخص';
            const sampleId = document.getElementById('sample-id').value || 'ندارد';
            
            document.getElementById('operator').textContent = operatorName;
            document.getElementById('report-operator').textContent = operatorName;
            document.getElementById('report-sample-id').textContent = sampleId;
            
            // دریافت داده‌های کالیبراسیون
            const { standards: naStds, readings: naReads } = getTableData('sodiumTable');
            const { standards: kStds, readings: kReads } = getTableData('potassiumTable');
            
            // دریافت داده‌های نمونه
            const naUnknown = parseFloat(document.getElementById('naUnknown').value);
            const naDilution = parseFloat(document.getElementById('naDilution').value) || 1;
            const kUnknown = parseFloat(document.getElementById('kUnknown').value);
            const kDilution = parseFloat(document.getElementById('kDilution').value) || 1;
            
            // محاسبه رگرسیون
            const { a: aNa, b: bNa, rSquared: r2Na } = linearRegression(naReads, naStds);
            const { a: aK, b: bK, rSquared: r2K } = linearRegression(kReads, kStds);
            
            // محاسبه غلظت‌ها
            const naConc = (aNa * naUnknown + bNa) * naDilution;
            const kConc = (aK * kUnknown + bK) * kDilution;
            const naKRatio = naConc / kConc;
            
            // نمایش نتایج
            document.getElementById("result-values").innerHTML = `
                <div class="result-value">غلظت سدیم: ${naConc.toFixed(2)} ppm</div>
                <div class="result-value">غلظت پتاسیم: ${kConc.toFixed(2)} ppm</div>
                <div style="margin-top: 20px;">
                    <strong>ضریب تعیین (R²) سدیم:</strong> ${r2Na.toFixed(4)}<br>
                    <strong>ضریب تعیین (R²) پتاسیم:</strong> ${r2K.toFixed(4)}
                </div>
            `;
            
            // به‌روزرسانی گزارش
            document.getElementById("key-results").innerHTML = `
                <ul>
                    <li>غلظت سدیم در نمونه خاک: <strong>${naConc.toFixed(2)} ppm</strong></li>
                    <li>غلظت پتاسیم در نمونه خاک: <strong>${kConc.toFixed(2)} ppm</strong></li>
                    <li>نسبت سدیم به پتاسیم: <strong>${naKRatio.toFixed(2)}</strong></li>
                    <li>کیفیت کالیبراسیون سدیم (R²): <strong>${r2Na.toFixed(4)}</strong></li>
                    <li>کیفیت کالیبراسیون پتاسیم (R²): <strong>${r2K.toFixed(4)}</strong></li>
                </ul>
            `;
            
            // به‌روزرسانی بخش محاسبات گزارش
            document.getElementById("calculations").innerHTML = `
                برای محاسبه غلظت‌های سدیم و پتاسیم، از معادلات رگرسیون خطی حاصل از داده‌های کالیبراسیون استفاده شد:<br>
                - معادله کالیبراسیون سدیم: C_Na = ${aNa.toFixed(4)} × R + ${bNa.toFixed(4)}<br>
                - معادله کالیبراسیون پتاسیم: C_K = ${aK.toFixed(4)} × R + ${bK.toFixed(4)}<br><br>
                غلظت واقعی با اعمال ضریب رقت (D) به صورت زیر محاسبه شد:<br>
                - غلظت واقعی سدیم: C_Na_real = (${aNa.toFixed(4)} × ${naUnknown.toFixed(2)} + ${bNa.toFixed(4)}) × ${naDilution} = ${naConc.toFixed(2)} ppm<br>
                - غلظت واقعی پتاسیم: C_K_real = (${aK.toFixed(4)} × ${kUnknown.toFixed(2)} + ${bK.toFixed(4)}) × ${kDilution} = ${kConc.toFixed(2)} ppm<br><br>
                نتایج محاسبات:<br>
                - سدیم: <span id="calc-na">${naConc.toFixed(2)} ppm</span><br>
                - پتاسیم: <span id="calc-k">${kConc.toFixed(2)} ppm</span><br>
                - ضریب تعیین (R²) سدیم: <span id="calc-r2-na">${r2Na.toFixed(4)}</span><br>
                - ضریب تعیین (R²) پتاسیم: <span id="calc-r2-k">${r2K.toFixed(4)}</span>
            `;
            
            // به‌روزرسانی بخش ارزیابی و نتایج
            let evaluationText = `نتایج حاصل از این آزمایش نشان‌دهنده غلظت‌های سدیم (${naConc.toFixed(2)} ppm) و پتاسیم (${kConc.toFixed(2)} ppm) در نمونه خاک است. این مقادیر با استانداردهای خاک‌های کشاورزی مقایسه شدند. `;
            if (naConc > 100) {
                evaluationText += `غلظت سدیم بالا بوده و خاک ممکن است به شوری حساس باشد که نیاز به اقدامات اصلاحی مانند شستشوی خاک یا افزودن گچ کشاورزی دارد. `;
            } else {
                evaluationText += `غلظت سدیم در محدوده قابل قبول قرار دارد. `;
            }
            if (kConc < 150) {
                evaluationText += `غلظت پتاسیم کمتر از حد مطلوب است که نشان‌دهنده نیاز به افزودن کودهای پتاسیمی مانند سولفات پتاسیم است. `;
            } else {
                evaluationText += `غلظت پتاسیم در محدوده مناسب برای رشد گیاهان قرار دارد. `;
            }
            evaluationText += `نسبت سدیم به پتاسیم (${naKRatio.toFixed(2)}) نیز ارزیابی شد. نسبت‌های بالاتر از ۰.۵ می‌توانند بر جذب پتاسیم توسط گیاه تأثیر منفی بگذارند.`;
            document.getElementById("evaluation-results").innerHTML = evaluationText;
            
            // به‌روزرسانی پیشنهادات گزارش
            let recommendationsReport = '<ul>';
            if (naConc > 100) {
                recommendationsReport += '<li>استفاده از گچ کشاورزی و شستشوی خاک برای کاهش شوری توصیه می‌شود.</li>';
            }
            if (kConc < 150) {
                recommendationsReport += '<li>افزودن کودهای پتاسیمی مانند سولفات پتاسیم یا کلرید پتاسیم برای جبران کمبود پتاسیم.</li>';
            }
            recommendationsReport += `
                <li>انجام آزمایش‌های دوره‌ای هر ۶ ماه برای پایش تغییرات غلظت عناصر در خاک.</li>
                <li>مشاوره با متخصصان خاک‌شناسی برای تدوین برنامه کوددهی بهینه.</li>
                <li>بررسی چرخه‌های آبیاری برای جلوگیری از تجمع نمک‌ها در خاک.</li>
            `;
            recommendationsReport += '</ul>';
            document.getElementById("recommendations-report").innerHTML = recommendationsReport;
            
            // به‌روزرسانی داشبورد
            document.getElementById("dashboard-na").textContent = naConc.toFixed(2);
            document.getElementById("dashboard-k").textContent = kConc.toFixed(2);
            document.getElementById("dashboard-ratio").textContent = naKRatio.toFixed(2);
            
            // ارزیابی وضعیت خاک
            let soilStatus = '';
            let statusColor = '';
            
            if (naConc > 100) {
                soilStatus = 'شور';
                statusColor = '#d32f2f';
            } else if (kConc < 150) {
                soilStatus = 'کمبود پتاسیم';
                statusColor = '#ffa000';
            } else if (naKRatio > 0.5) {
                soilStatus = 'نیاز به اصلاح';
                statusColor = '#ffa000';
            } else {
                soilStatus = 'مطلوب';
                statusColor = '#388e3c';
            }
            
            document.getElementById("dashboard-status").textContent = soilStatus;
            document.getElementById("dashboard-status").style.color = statusColor;
            
            // تولید توصیه‌ها
            let recommendations = '<ul>';
            
            if (naConc > 100) {
                recommendations += '<li>خاک دارای شوری بالا است. توصیه می‌شود از روش‌های شستشوی خاک و استفاده از گچ کشاورزی استفاده شود.</li>';
            }
            
            if (kConc < 150) {
                recommendations += '<li>خاک دچار کمبود پتاسیم است. توصیه می‌شود از کودهای پتاسیمی مانند سولفات پتاسیم یا کلرید پتاسیم استفاده شود.</li>';
            }
            
            if (naKRatio > 0.5) {
                recommendations += '<li>نسبت سدیم به پتاسیم بالا است که می‌تواند بر جذب پتاسیم توسط گیاه تأثیر بگذارد.</li>';
            }
            
            if (soilStatus === 'مطلوب') {
                recommendations += '<li>خاک از نظر سدیم و پتاسیم در وضعیت مطلوب قرار دارد. برنامه کوددهی فعلی را ادامه دهید.</li>';
            }
            
            recommendations += '</ul>';
            document.getElementById("recommendations").innerHTML = recommendations;
            
            // رسم نمودارها
            drawChart2D('chartNa2D', naReads, naStds, aNa, bNa, 'سدیم', naUnknown, naConc);
            drawChart2D('chartK2D', kReads, kStds, aK, bK, 'پتاسیم', kUnknown, kConc);
            drawDashboardChart(naConc, kConc);
            
            // رفتن به تب نتایج
            openTab('results');
        }
        
        // رسم نمودار 2D
        function drawChart2D(canvasId, x, y, a, b, label, unknownX, unknownY) {
            const ctx = document.getElementById(canvasId).getContext('2d');
            
            // حذف نمودار قبلی اگر وجود دارد
            if (window[canvasId + 'Chart']) {
                window[canvasId + 'Chart'].destroy();
            }
            
            const regressionLine = x.map(val => a * val + b);
            const datasets = [
                {
                    label: `${label} - نقاط استاندارد`,
                    data: y.map((yVal, i) => ({x: x[i], y: yVal})),
                    borderColor: '#2e7d32',
                    backgroundColor: '#2e7d32',
                    pointRadius: 6,
                    pointHoverRadius: 8,
                    showLine: false
                },
                {
                    label: `${label} - خط رگرسیون`,
                    data: regressionLine.map((yVal, i) => ({x: x[i], y: yVal})),
                    borderColor: '#ff8f00',
                    borderWidth: 2,
                    borderDash: [5, 5],
                    fill: false,
                    pointRadius: 0
                }
            ];
            
            if (unknownX && !isNaN(unknownX)) {
                datasets.push({
                    label: `نمونه ناشناخته ${label}`,
                    data: [{x: unknownX, y: unknownY}],
                    borderColor: '#d32f2f',
                    backgroundColor: '#d32f2f',
                    pointRadius: 8,
                    pointHoverRadius: 10,
                    pointStyle: 'triangle'
                });
            }
            
            window[canvasId + 'Chart'] = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            rtl: true
                        },
                        title: {
                            display: true,
                            text: `منحنی کالیبراسیون ${label}`,
                            font: {
                                size: 16
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${label}: ${context.parsed.y.toFixed(2)} ppm (خوانش: ${context.parsed.x.toFixed(2)})`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'عدد دستگاه'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'غلظت (ppm)'
                            }
                        }
                    }
                }
            });
        }
        
        // رسم نمودار داشبورد
        function drawDashboardChart(naConc, kConc) {
            const ctx = document.getElementById('dashboard-chart').getContext('2d');
            
            // حذف نمودار قبلی اگر وجود دارد
            if (window.dashboardChart) {
                window.dashboardChart.destroy();
            }
            
            const optimalNa = 50;
            const optimalK = 200;
            
            window.dashboardChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['سدیم (Na)', 'پتاسیم (K)'],
                    datasets: [
                        {
                            label: 'غلظت اندازه‌گیری شده',
                            data: [naConc, kConc],
                            backgroundColor: ['#5c6bc0', '#26a69a'],
                            borderColor: ['#3949ab', '#00897b'],
                            borderWidth: 1
                        },
                        {
                            label: 'محدوده مطلوب',
                            data: [optimalNa, optimalK],
                            backgroundColor: ['#9fa8da', '#80cbc4'],
                            borderColor: ['#7986cb', '#4db6ac'],
                            borderWidth: 1,
                            type: 'line',
                            fill: false,
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            rtl: true
                        },
                        title: {
                            display: true,
                            text: 'مقایسه غلظت‌ها با محدوده مطلوب',
                            font: {
                                size: 16
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'غلظت (ppm)'
                            }
                        }
                    }
                }
            });
        }
        
        // توابع صادرات (نمادین)
        function exportToPDF() {
            alert('این قابلیت در نسخه کامل سیستم فعال خواهد شد. گزارش به PDF تبدیل می‌شود.');
        }
        
        function exportToExcel() {
            alert('این قابلیت در نسخه کامل سیستم فعال خواهد شد. داده‌ها به Excel صادر می‌شوند.');
        }
        
        function printReport() {
            window.print();
        }
        
        // بارگذاری اولیه
        updateSampleCount();
    </script>
</body>
</html>